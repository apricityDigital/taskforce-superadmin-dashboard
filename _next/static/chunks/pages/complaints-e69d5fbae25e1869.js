(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[67],{4464:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});var s=a(4297);let r=(0,s.Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},6895:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});var s=a(4297);let r=(0,s.Z)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]])},3718:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});var s=a(4297);let r=(0,s.Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},1150:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/complaints",function(){return a(5071)}])},5140:function(e,t,a){"use strict";a.d(t,{D:function(){return DataService}});var s=a(9828),r=a(7889);let DataService=class DataService{static async getDashboardStats(){try{let[e,t,a,i,n,l,o,c]=await Promise.all([(0,s.PL)((0,s.hJ)(r.db,"approvedUsers")),(0,s.PL)((0,s.IO)((0,s.hJ)(r.db,"approvedUsers"),(0,s.ar)("isActive","==",!0))),(0,s.PL)((0,s.IO)((0,s.hJ)(r.db,"accessRequests"),(0,s.ar)("status","==","pending"))),(0,s.PL)((0,s.hJ)(r.db,"complianceReports")),(0,s.PL)((0,s.hJ)(r.db,"inspections")),(0,s.PL)((0,s.hJ)(r.db,"feederPoints")),(0,s.PL)((0,s.hJ)(r.db,"teams")),(0,s.PL)((0,s.hJ)(r.db,"ipRecords"))]);return{totalUsers:e.size,activeUsers:t.size,pendingRequests:a.size,totalComplaints:i.size,totalInspections:n.size,totalFeederPoints:l.size,totalTeams:o.size,totalIPRecords:c.size}}catch(e){return console.error("Error fetching dashboard stats:",e),{totalUsers:0,activeUsers:0,pendingRequests:0,totalComplaints:0,totalInspections:0,totalFeederPoints:0,totalTeams:0,totalIPRecords:0}}}static onUsersChange(e){let t=(0,s.IO)((0,s.hJ)(r.db,"approvedUsers"),(0,s.Xo)("createdAt","desc"));return(0,s.cf)(t,t=>{let a=t.docs.map(e=>({id:e.id,...e.data()}));e(a)})}static async getAllUsers(){let e=(0,s.IO)((0,s.hJ)(r.db,"approvedUsers")),t=await (0,s.PL)(e),a=t.docs.map(e=>({id:e.id,...e.data()}));return a}static onAccessRequestsChange(e){let t=(0,s.IO)((0,s.hJ)(r.db,"accessRequests"),(0,s.Xo)("createdAt","desc"));return(0,s.cf)(t,t=>{let a=t.docs.map(e=>({id:e.id,...e.data()}));e(a)})}static onComplaintsChange(e){let t=(0,s.IO)((0,s.hJ)(r.db,"complaints"),(0,s.Xo)("createdAt","desc"));return(0,s.cf)(t,t=>{let a=t.docs.map(e=>({id:e.id,...e.data()}));e(a)})}static async getAllComplaints(){let e=(0,s.IO)((0,s.hJ)(r.db,"complaints")),t=await (0,s.PL)(e),a=t.docs.map(e=>({id:e.id,...e.data()}));return a}static async getAllComplianceReports(){let e=(0,s.IO)((0,s.hJ)(r.db,"complianceReports"),(0,s.Xo)("submittedAt","desc")),t=await (0,s.PL)(e),a=t.docs.map(e=>({id:e.id,...e.data()}));return a}static onComplianceReportsChange(e){let t=(0,s.IO)((0,s.hJ)(r.db,"complianceReports"),(0,s.Xo)("submittedAt","desc"));return(0,s.cf)(t,t=>{let a=t.docs.map(e=>({id:e.id,...e.data()}));e(a)})}static async updateComplianceReportStatus(e,t,a,i){try{let n={status:t,reviewedAt:(0,s.Bt)(),updatedAt:(0,s.Bt)()};a&&(n.adminNotes=a),i&&(n.reviewedBy=i),await (0,s.r7)((0,s.JU)(r.db,"complianceReports",e),n),console.log("✅ Compliance report status updated:",e,t)}catch(e){throw console.error("❌ Error updating compliance report status:",e),e}}static onIPRecordsChange(e){let t=(0,s.IO)((0,s.hJ)(r.db,"ipRecords"),(0,s.Xo)("registeredAt","desc"));return(0,s.cf)(t,t=>{let a=t.docs.map(e=>({id:e.id,...e.data()}));e(a)})}static onFeederPointsChange(e){let t=(0,s.IO)((0,s.hJ)(r.db,"feederPoints"));return(0,s.cf)(t,t=>{let a=t.docs.map(e=>({id:e.id,...e.data()}));e(a)})}static async getAllFeederPoints(){let e=(0,s.IO)((0,s.hJ)(r.db,"feederPoints")),t=await (0,s.PL)(e),a=t.docs.map(e=>({id:e.id,...e.data()}));return a}static onTeamsChange(e){let t=(0,s.IO)((0,s.hJ)(r.db,"teams"));return(0,s.cf)(t,t=>{let a=t.docs.map(e=>({id:e.id,...e.data()}));e(a)})}static async updateFeederPoint(e,t){let a=(0,s.JU)(r.db,"feederPoints",e);await (0,s.r7)(a,t)}static async createFeederPoint(e){let t=(0,s.hJ)(r.db,"feederPoints");await (0,s.pl)((0,s.JU)(t),e,{merge:!0})}static async deleteFeederPoint(e){let t=(0,s.JU)(r.db,"feederPoints",e);await (0,s.oe)(t)}static async createSampleFeederPoints(){let e=(0,s.hJ)(r.db,"feederPoints");for(let t of[{name:"FP-001",status:"active",priority:"high",location:{address:"123 Main St",latitude:34.0522,longitude:-118.2437}},{name:"FP-002",status:"maintenance",priority:"medium",location:{address:"456 Oak Ave",latitude:34.0522,longitude:-118.2437}},{name:"FP-003",status:"inactive",priority:"low",location:{address:"789 Pine Ln",latitude:34.0522,longitude:-118.2437}}])await (0,s.pl)((0,s.JU)(e),t)}static async getRecentActivity(){try{let e=(0,s.IO)((0,s.hJ)(r.db,"recentActivity"),(0,s.Xo)("timestamp","desc"),(0,s.b9)(10)),t=await (0,s.PL)(e),a=t.docs.map(e=>({id:e.id,...e.data()}));return a}catch(e){return console.error("Error fetching recent activity:",e),[]}}static async approveAccessRequest(e){try{let t=(0,s.JU)(r.db,"accessRequests",e.id);await (0,s.r7)(t,{status:"approved",reviewedAt:(0,s.Bt)(),reviewedBy:"AdminUserPlaceholder",updatedAt:(0,s.Bt)()}),console.log("✅ Access request approved:",e.id)}catch(e){throw console.error("❌ Error approving access request:",e),e}}static async rejectAccessRequest(e){try{let t=(0,s.JU)(r.db,"accessRequests",e);await (0,s.r7)(t,{status:"rejected",reviewedAt:(0,s.Bt)(),reviewedBy:"AdminUserPlaceholder",updatedAt:(0,s.Bt)()}),console.log("✅ Access request rejected:",e)}catch(e){throw console.error("❌ Error rejecting access request:",e),e}}static async updateComplaint(e,t){try{let a=(0,s.JU)(r.db,"complaints",e);await (0,s.r7)(a,{...t,updatedAt:(0,s.Bt)()}),console.log("✅ Complaint updated:",e)}catch(e){throw console.error("❌ Error updating complaint:",e),e}}static async deleteComplaint(e){try{await (0,s.oe)((0,s.JU)(r.db,"complaints",e)),console.log("✅ Complaint deleted:",e)}catch(e){throw console.error("❌ Error deleting complaint:",e),e}}static async testDatabaseConnection(){try{console.log("Attempting to fetch collections from Firestore...");let e=await Promise.all([(0,s.PL)((0,s.hJ)(r.db,"approvedUsers")),(0,s.PL)((0,s.hJ)(r.db,"accessRequests")),(0,s.PL)((0,s.hJ)(r.db,"complianceReports")),(0,s.PL)((0,s.hJ)(r.db,"feederPoints")),(0,s.PL)((0,s.hJ)(r.db,"teams"))]);return console.log("Successfully fetched collections:"),console.log("- approvedUsers: ".concat(e[0].size," documents")),console.log("- accessRequests: ".concat(e[1].size," documents")),console.log("- complianceReports: ".concat(e[2].size," documents")),console.log("- feederPoints: ".concat(e[3].size," documents")),console.log("- teams: ".concat(e[4].size," documents")),!0}catch(e){return console.error("Error testing database connection:",e),!1}}static async getUserReports(e){let t=(0,s.IO)((0,s.hJ)(r.db,"complianceReports"),(0,s.ar)("userId","==",e)),a=await (0,s.PL)(t);return a.docs.map(e=>({id:e.id,...e.data()}))}static async getUserFeederPoints(e){let t=(0,s.IO)((0,s.hJ)(r.db,"feederPoints"),(0,s.ar)("assignedUserId","==",e)),a=await (0,s.PL)(t);return a.docs.map(e=>({id:e.id,...e.data()}))}static async updateUser(e,t){let a=(0,s.JU)(r.db,"approvedUsers",e);await (0,s.r7)(a,t)}static async deleteUser(e){let t=(0,s.JU)(r.db,"approvedUsers",e);await (0,s.oe)(t)}}},7889:function(e,t,a){"use strict";a.d(t,{db:function(){return o}});var s=a(3977),r=a(9828),i=a(3454);let n={apiKey:i.env.EXPO_PUBLIC_FIREBASE_API_KEY||"AIzaSyAUl-1iNJo7MjMgKk_vBaBKeDNEYVSxSDE",authDomain:i.env.EXPO_PUBLIC_FIREBASE_AUTH_DOMAIN||"task-force-b1ff7.firebaseapp.com",projectId:i.env.EXPO_PUBLIC_FIREBASE_PROJECT_ID||"task-force-b1ff7",storageBucket:i.env.EXPO_PUBLIC_FIREBASE_STORAGE_BUCKET||"task-force-b1ff7.firebasestorage.app",messagingSenderId:i.env.EXPO_PUBLIC_FIREBASE_MESSAGING_SENDER_ID||"1029709761200",appId:i.env.EXPO_PUBLIC_FIREBASE_APP_ID||"1:1029709761200:web:d051815003907ec7f14975"},l=(0,s.ZF)(n),o=(0,r.ad)(l)},5071:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return ComplaintsPage}});var s=a(5893),r=a(7294),i=a(4464),n=a(6895),l=a(3718),o=a(5140);function ComplaintsPage(){let[e,t]=(0,r.useState)([]),[a,c]=(0,r.useState)([]),[d,u]=(0,r.useState)(!0),[m,p]=(0,r.useState)(""),[h,f]=(0,r.useState)("all"),[g,b]=(0,r.useState)("all"),[y,x]=(0,r.useState)(null),[v,w]=(0,r.useState)(!1),[P,C]=(0,r.useState)(null),[j,E]=(0,r.useState)(!1),loadComplaints=()=>{u(!0);let e=o.D.onComplaintsChange(e=>{t(e),u(!1)});return e};(0,r.useEffect)(()=>{let e=loadComplaints();return()=>e()},[]),(0,r.useEffect)(()=>{filterComplaints()},[e,m,h,g]);let filterComplaints=()=>{let t=e;m&&(t=t.filter(e=>e.title.toLowerCase().includes(m.toLowerCase())||e.description.toLowerCase().includes(m.toLowerCase()))),"all"!==h&&(t=t.filter(e=>e.status===h)),"all"!==g&&(t=t.filter(e=>e.priority===g)),c(t)},handleViewComplaint=e=>{x(e),w(!0)},handleEditComplaint=e=>{C({...e}),E(!0)},handleSaveComplaint=async()=>{if(P)try{await o.D.updateComplaint(P.id,P),await loadComplaints(),E(!1),C(null),alert("Complaint updated successfully!")}catch(e){console.error("Error updating complaint:",e),alert("Error updating complaint. Please try again.")}},handleDeleteComplaint=async e=>{if(confirm('Are you sure you want to delete complaint "'.concat(e.title,'"?')))try{await o.D.deleteComplaint(e.id),await loadComplaints(),alert("Complaint deleted successfully!")}catch(e){console.error("Error deleting complaint:",e),alert("Error deleting complaint. Please try again.")}};return d?(0,s.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold",children:"Complaints"}),(0,s.jsx)("div",{className:"table-container",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"table-header",children:"Title"}),(0,s.jsx)("th",{className:"table-header",children:"Category"}),(0,s.jsx)("th",{className:"table-header",children:"Priority"}),(0,s.jsx)("th",{className:"table-header",children:"Status"}),(0,s.jsx)("th",{className:"table-header",children:"Reported By"}),(0,s.jsx)("th",{className:"table-header",children:"Created At"}),(0,s.jsx)("th",{className:"table-header",children:"Actions"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:a.map(e=>{var t,a;return(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"table-cell",children:e.title}),(0,s.jsx)("td",{className:"table-cell",children:e.category}),(0,s.jsx)("td",{className:"table-cell",children:e.priority}),(0,s.jsx)("td",{className:"table-cell",children:e.status}),(0,s.jsx)("td",{className:"table-cell",children:e.reportedBy}),(0,s.jsx)("td",{className:"table-cell",children:null===(a=e.createdAt)||void 0===a?void 0:null===(t=a.toDate)||void 0===t?void 0:t.call(a).toLocaleDateString()}),(0,s.jsx)("td",{className:"table-cell",children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("button",{onClick:()=>handleViewComplaint(e),children:(0,s.jsx)(i.Z,{className:"h-4 w-4"})}),(0,s.jsx)("button",{onClick:()=>handleEditComplaint(e),children:(0,s.jsx)(n.Z,{className:"h-4 w-4"})}),(0,s.jsx)("button",{onClick:()=>handleDeleteComplaint(e),children:(0,s.jsx)(l.Z,{className:"h-4 w-4"})})]})})]},e.id)})})]})}),j&&P&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,s.jsxs)("div",{className:"flex items-center justify-center min-h-screen",children:[(0,s.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75",onClick:()=>E(!1)}),(0,s.jsx)("div",{className:"bg-white rounded-lg shadow-xl transform transition-all sm:max-w-lg sm:w-full",children:(0,s.jsxs)("div",{className:"px-4 py-5 sm:p-6",children:[(0,s.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Edit Complaint"}),(0,s.jsx)("div",{className:"mt-2 max-w-xl text-sm text-gray-500",children:(0,s.jsx)("p",{children:"Update the details of the complaint."})}),(0,s.jsxs)("form",{className:"mt-5 sm:flex sm:items-center",children:[(0,s.jsxs)("div",{className:"w-full sm:max-w-xs",children:[(0,s.jsx)("label",{htmlFor:"status",className:"sr-only",children:"Status"}),(0,s.jsxs)("select",{id:"status",name:"status",value:P.status,onChange:e=>C({...P,status:e.target.value}),className:"block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",children:[(0,s.jsx)("option",{value:"open",children:"Open"}),(0,s.jsx)("option",{value:"in_progress",children:"In Progress"}),(0,s.jsx)("option",{value:"resolved",children:"Resolved"}),(0,s.jsx)("option",{value:"closed",children:"Closed"})]})]}),(0,s.jsx)("button",{type:"button",onClick:handleSaveComplaint,className:"mt-3 w-full inline-flex items-center justify-center px-4 py-2 border border-transparent shadow-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",children:"Save"}),(0,s.jsx)("button",{type:"button",onClick:()=>E(!1),className:"mt-3 w-full inline-flex items-center justify-center px-4 py-2 border border-gray-300 shadow-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",children:"Cancel"})]})]})})]})})]})}}},function(e){e.O(0,[16,868,774,888,179],function(){return e(e.s=1150)}),_N_E=e.O()}]);