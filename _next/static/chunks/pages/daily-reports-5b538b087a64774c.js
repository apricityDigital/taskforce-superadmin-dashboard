(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[20],{8795:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/daily-reports",function(){return s(1979)}])},5140:function(e,t,s){"use strict";s.d(t,{D:function(){return DataService}});var a=s(9828),n=s(7889);let DataService=class DataService{static async getDashboardStats(){try{let[e,t,s,r,i,o,l,c]=await Promise.all([(0,a.PL)((0,a.hJ)(n.db,"approvedUsers")),(0,a.PL)((0,a.IO)((0,a.hJ)(n.db,"approvedUsers"),(0,a.ar)("isActive","==",!0))),(0,a.PL)((0,a.IO)((0,a.hJ)(n.db,"accessRequests"),(0,a.ar)("status","==","pending"))),(0,a.PL)((0,a.hJ)(n.db,"complianceReports")),(0,a.PL)((0,a.hJ)(n.db,"inspections")),(0,a.PL)((0,a.hJ)(n.db,"feederPoints")),(0,a.PL)((0,a.hJ)(n.db,"teams")),(0,a.PL)((0,a.hJ)(n.db,"ipRecords"))]),d=e.docs.map(e=>({id:e.id,...e.data()})),m=t.docs.map(e=>({id:e.id,...e.data()})),p=d.filter(e=>"admin"===e.role).length,u=d.filter(e=>"task_force_team"===e.role).length,h=d.filter(e=>"commissioner"===e.role).length,g=d.filter(e=>!e.isActive).length,x=m.filter(e=>"admin"===e.role).length,f=m.filter(e=>"task_force_team"===e.role).length,y=m.filter(e=>"commissioner"===e.role).length;return{totalUsers:e.size,activeUsers:t.size,pendingRequests:s.size,totalComplaints:r.size,totalInspections:i.size,totalFeederPoints:o.size,totalTeams:l.size,totalIPRecords:c.size,adminUsers:p,taskForceUsers:u,commissionerUsers:h,inactiveUsers:g,activeAdmins:x,activeTaskForce:f,activeCommissioners:y}}catch(e){return console.error("Error fetching dashboard stats:",e),{totalUsers:0,activeUsers:0,pendingRequests:0,totalComplaints:0,totalInspections:0,totalFeederPoints:0,totalTeams:0,totalIPRecords:0,adminUsers:0,taskForceUsers:0,commissionerUsers:0,inactiveUsers:0,activeAdmins:0,activeTaskForce:0,activeCommissioners:0}}}static onUsersChange(e){let t=(0,a.IO)((0,a.hJ)(n.db,"approvedUsers"),(0,a.Xo)("createdAt","desc"));return(0,a.cf)(t,t=>{let s=t.docs.map(e=>({id:e.id,...e.data()}));e(s)})}static async getAllUsers(){let e=(0,a.IO)((0,a.hJ)(n.db,"approvedUsers")),t=await (0,a.PL)(e),s=t.docs.map(e=>({id:e.id,...e.data()}));return s}static onAccessRequestsChange(e){let t=(0,a.IO)((0,a.hJ)(n.db,"accessRequests"),(0,a.Xo)("createdAt","desc"));return(0,a.cf)(t,t=>{let s=t.docs.map(e=>({id:e.id,...e.data()}));e(s)})}static onComplaintsChange(e){let t=(0,a.IO)((0,a.hJ)(n.db,"complaints"),(0,a.Xo)("createdAt","desc"));return(0,a.cf)(t,t=>{let s=t.docs.map(e=>({id:e.id,...e.data()}));e(s)})}static async getAllComplaints(){let e=(0,a.IO)((0,a.hJ)(n.db,"complaints")),t=await (0,a.PL)(e),s=t.docs.map(e=>({id:e.id,...e.data()}));return s}static async getAllComplianceReports(){let e=(0,a.IO)((0,a.hJ)(n.db,"complianceReports"),(0,a.Xo)("submittedAt","desc")),t=await (0,a.PL)(e),s=t.docs.map(e=>({id:e.id,...e.data()}));return s}static onComplianceReportsChange(e){let t=(0,a.IO)((0,a.hJ)(n.db,"complianceReports"),(0,a.Xo)("submittedAt","desc"));return(0,a.cf)(t,t=>{let s=t.docs.map(e=>({id:e.id,...e.data()}));e(s)})}static async updateComplianceReportStatus(e,t,s,r){try{let i={status:t,reviewedAt:(0,a.Bt)(),updatedAt:(0,a.Bt)()};s&&(i.adminNotes=s),r&&(i.reviewedBy=r),await (0,a.r7)((0,a.JU)(n.db,"complianceReports",e),i),console.log("✅ Compliance report status updated:",e,t)}catch(e){throw console.error("❌ Error updating compliance report status:",e),e}}static onIPRecordsChange(e){let t=(0,a.IO)((0,a.hJ)(n.db,"ipRecords"),(0,a.Xo)("registeredAt","desc"));return(0,a.cf)(t,t=>{let s=t.docs.map(e=>({id:e.id,...e.data()}));e(s)})}static onFeederPointsChange(e){let t=(0,a.IO)((0,a.hJ)(n.db,"feederPoints"));return(0,a.cf)(t,t=>{let s=t.docs.map(e=>({id:e.id,...e.data()}));e(s)})}static async getAllFeederPoints(){let e=(0,a.IO)((0,a.hJ)(n.db,"feederPoints")),t=await (0,a.PL)(e),s=t.docs.map(e=>({id:e.id,...e.data()}));return s}static onTeamsChange(e){let t=(0,a.IO)((0,a.hJ)(n.db,"teams"));return(0,a.cf)(t,t=>{let s=t.docs.map(e=>({id:e.id,...e.data()}));e(s)})}static async updateFeederPoint(e,t){let s=(0,a.JU)(n.db,"feederPoints",e);await (0,a.r7)(s,t)}static async createFeederPoint(e){let t=(0,a.hJ)(n.db,"feederPoints");await (0,a.pl)((0,a.JU)(t),e,{merge:!0})}static async deleteFeederPoint(e){let t=(0,a.JU)(n.db,"feederPoints",e);await (0,a.oe)(t)}static async createSampleFeederPoints(){let e=(0,a.hJ)(n.db,"feederPoints");for(let t of[{name:"FP-001",status:"active",priority:"high",location:{address:"123 Main St",latitude:34.0522,longitude:-118.2437}},{name:"FP-002",status:"maintenance",priority:"medium",location:{address:"456 Oak Ave",latitude:34.0522,longitude:-118.2437}},{name:"FP-003",status:"inactive",priority:"low",location:{address:"789 Pine Ln",latitude:34.0522,longitude:-118.2437}}])await (0,a.pl)((0,a.JU)(e),t)}static async getRecentActivity(){try{let e=(0,a.IO)((0,a.hJ)(n.db,"recentActivity"),(0,a.Xo)("timestamp","desc"),(0,a.b9)(10)),t=await (0,a.PL)(e),s=t.docs.map(e=>({id:e.id,...e.data()}));return s}catch(e){return console.error("Error fetching recent activity:",e),[]}}static async approveAccessRequest(e){try{let t=(0,a.JU)(n.db,"accessRequests",e.id);await (0,a.r7)(t,{status:"approved",reviewedAt:(0,a.Bt)(),reviewedBy:"AdminUserPlaceholder",updatedAt:(0,a.Bt)()}),console.log("✅ Access request approved:",e.id)}catch(e){throw console.error("❌ Error approving access request:",e),e}}static async rejectAccessRequest(e){try{let t=(0,a.JU)(n.db,"accessRequests",e);await (0,a.r7)(t,{status:"rejected",reviewedAt:(0,a.Bt)(),reviewedBy:"AdminUserPlaceholder",updatedAt:(0,a.Bt)()}),console.log("✅ Access request rejected:",e)}catch(e){throw console.error("❌ Error rejecting access request:",e),e}}static async updateComplaint(e,t){try{let s=(0,a.JU)(n.db,"complaints",e);await (0,a.r7)(s,{...t,updatedAt:(0,a.Bt)()}),console.log("✅ Complaint updated:",e)}catch(e){throw console.error("❌ Error updating complaint:",e),e}}static async deleteComplaint(e){try{await (0,a.oe)((0,a.JU)(n.db,"complaints",e)),console.log("✅ Complaint deleted:",e)}catch(e){throw console.error("❌ Error deleting complaint:",e),e}}static async testDatabaseConnection(){try{console.log("Attempting to fetch collections from Firestore...");let e=await Promise.all([(0,a.PL)((0,a.hJ)(n.db,"approvedUsers")),(0,a.PL)((0,a.hJ)(n.db,"accessRequests")),(0,a.PL)((0,a.hJ)(n.db,"complianceReports")),(0,a.PL)((0,a.hJ)(n.db,"feederPoints")),(0,a.PL)((0,a.hJ)(n.db,"teams"))]);return console.log("Successfully fetched collections:"),console.log("- approvedUsers: ".concat(e[0].size," documents")),console.log("- accessRequests: ".concat(e[1].size," documents")),console.log("- complianceReports: ".concat(e[2].size," documents")),console.log("- feederPoints: ".concat(e[3].size," documents")),console.log("- teams: ".concat(e[4].size," documents")),!0}catch(e){return console.error("Error testing database connection:",e),!1}}static async getUserReports(e){let t=(0,a.IO)((0,a.hJ)(n.db,"complianceReports"),(0,a.ar)("userId","==",e)),s=await (0,a.PL)(t);return s.docs.map(e=>({id:e.id,...e.data()}))}static async getUserFeederPoints(e){let t=(0,a.IO)((0,a.hJ)(n.db,"feederPoints"),(0,a.ar)("assignedUserId","==",e)),s=await (0,a.PL)(t);return s.docs.map(e=>({id:e.id,...e.data()}))}static async updateUser(e,t){let s=(0,a.JU)(n.db,"approvedUsers",e);await (0,a.r7)(s,t)}static async deleteUser(e){let t=(0,a.JU)(n.db,"approvedUsers",e);await (0,a.oe)(t)}}},7889:function(e,t,s){"use strict";s.d(t,{db:function(){return i}});var a=s(3977),n=s(9828);let r=(0,a.ZF)({apiKey:"AIzaSyAUl-1iNJo7MjMgKk_vBaBKeDNEYVSxSDE",authDomain:"task-force-b1ff7.firebaseapp.com",projectId:"task-force-b1ff7",storageBucket:"task-force-b1ff7.firebasestorage.app",messagingSenderId:"1029709761200",appId:"1:1029709761200:web:d051815003907ec7f14975"}),i=(0,n.ad)(r)},1979:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return DailyReportsPage}});var a=s(5893),n=s(7294),r=s(5152),i=s.n(r),o=s(5077),l=s(3756),c=s(1352),d=s(1853),m=s(3766),p=s(5162),u=s(3025),h=s(4464),g=s(5283),x=s(4933),f=s(3271),y=s(8814),b=s(4423),v=s(2674),j=s(4998),w=s(7928),N=s(5140),A=s(1341);let AIService=class AIService{static async generateAnalysis(e){try{if(console.log("DEBUG: AIService.API_KEY:",this.API_KEY?"Set":"Not Set"),!this.API_KEY)return console.log("\uD83E\uDD16 No Gemini API key found, using simulation"),this.simulateAnalysis(e);let t=this.buildDetailedPrompt(e),s=this.buildConcisePrompt(e),a=this.genAI.getGenerativeModel({model:"gemini-1.5-flash"}),[n,r]=await Promise.all([a.generateContent(t),a.generateContent(s)]),i=n.response.text(),o=r.response.text();return{detailed:i,summary:o}}catch(t){return console.error("❌ Error calling Gemini API:",t),this.simulateAnalysis(e)}}static async generateMinistryReport(e,t){let s=new Date(e.date),a=s.toLocaleDateString("en-IN",{weekday:"long",year:"numeric",month:"long",day:"numeric"});return"\nGOVERNMENT OF INDIA\nMINISTRY OF HOME AFFAIRS\nTASKFORCE COMMAND CENTER\n\nDAILY OPERATIONAL REPORT\n".concat(a,"\n\nCLASSIFICATION: OFFICIAL USE ONLY\nREPORT ID: TCR-").concat(s.getFullYear(),"-").concat(String(s.getMonth()+1).padStart(2,"0"),"-").concat(String(s.getDate()).padStart(2,"0"),"\nGENERATED: ").concat(new Date().toLocaleString("en-IN"),"\n\n═══════════════════════════════════════════════════════════════\n\nEXECUTIVE SUMMARY:\n").concat(t,"\n\n═══════════════════════════════════════════════════════════════\n\nOPERATIONAL METRICS:\n\n\uD83D\uDCCA USER MANAGEMENT:\n   • Total Registered Users: ").concat(e.metrics.totalUsers.toLocaleString(),"\n   • New Registrations Today: ").concat(e.metrics.newRegistrations,"\n   • User Growth Rate: ").concat(e.performance.userGrowth>0?"+":"").concat(e.performance.userGrowth,"\n\n\uD83C\uDFAF SERVICE DELIVERY:\n   • Complaints Received: ").concat(e.metrics.totalComplaints,"\n   • Complaints Resolved: ").concat(e.metrics.resolvedComplaints,"\n   • Resolution Rate: ").concat(e.performance.complaintResolutionRate,"%\n   • Pending Cases: ").concat(e.metrics.totalComplaints-e.metrics.resolvedComplaints,"\n\n\uD83D\uDDFA️ FIELD OPERATIONS:\n   • Active Monitoring Points: ").concat(e.metrics.activeFeederPoints,"\n   • Completed Inspections: ").concat(e.metrics.completedInspections,"\n   • Operational Coverage: ").concat(e.performance.operationalEfficiency,"%\n\n═══════════════════════════════════════════════════════════════\n\nPERFORMANCE INDICATORS:\n\n✅ SYSTEM AVAILABILITY: 99.9%\n✅ RESPONSE TIME: < 2 seconds average\n✅ DATA INTEGRITY: 100% verified\n✅ SECURITY STATUS: All systems secure\n\n═══════════════════════════════════════════════════════════════\n\nTREND ANALYSIS:\n\n").concat(this.generateTrendAnalysis(e),"\n\n═══════════════════════════════════════════════════════════════\n\nRECOMMENDATIONS:\n\n").concat(this.generateRecommendations(e),"\n\n═══════════════════════════════════════════════════════════════\n\nNEXT DAY PRIORITIES:\n1. Continue monitoring complaint resolution times\n2. Maintain user engagement initiatives\n3. Ensure all feeder points remain operational\n4. Review and update security protocols\n\n═══════════════════════════════════════════════════════════════\n\nPREPARED BY: Taskforce Command Center - Automated Reporting System\nREVIEWED BY: Super Administrator\nSUBMITTED TO: Ministry of Home Affairs\nDISTRIBUTION: Secretary (Internal Security), Joint Secretary (Operations)\n\nEND OF REPORT\n    ")}static aggregateQuestionAnswers(e){let t=new Map;e.forEach(e=>{e.answers.forEach(s=>{let{questionId:a,answer:n,notes:r}=s;t.has(a)||t.set(a,new Map);let i=t.get(a);i.has(n)||i.set(n,{count:0,reportIds:[],notes:[]});let o=i.get(n);o.count++,o.reportIds.push(e.id),r&&o.notes.push("Report ".concat(e.id,": ").concat(r))})});let s="\n\nAggregated Question-Answer Analysis:\n";return 0===t.size?s+="No specific question-answer data available for aggregation.\n":(t.forEach((e,t)=>{s+='\nQuestion: "'.concat(t,'"\n');let a=0;e.forEach(e=>a+=e.count),e.forEach((e,t)=>{let n=a>0?(e.count/a*100).toFixed(0):0;s+='- "'.concat(t,'": ').concat(e.count," times (").concat(n,"%)\n"),e.notes.length>0&&(s+="  Notes: ".concat(e.notes.join("; "),"\n")),e.reportIds.length>0&&(s+="  Occurrences in Report IDs: ".concat(e.reportIds.join(", "),"\n"))})}),s)}static buildDetailedPrompt(e){let t="";e.rawReports&&e.rawReports.length>0&&(t="\n\nRaw Reports Data (for detailed analysis): For specific examples and context, refer to these individual reports:\n",e.rawReports.forEach((e,s)=>{t+="\n--- Report ".concat(e.id," (Feeder Point: ").concat(e.feederPointName,", Submitted By: ").concat(e.userName,") ---\n")+"Status: ".concat(e.status,", Priority: ").concat(e.priority,", Trip: ").concat(e.tripNumber," on ").concat(e.tripDate,"\n"),e.answers.forEach(e=>{t+="  Q: ".concat(e.questionId,"\n")+"  A: ".concat(e.answer,"\n"),e.notes&&(t+="  Notes: ".concat(e.notes,"\n"))}),t+="Description: ".concat(e.description,"\n")}));let s=this.aggregateQuestionAnswers(e.rawReports);return"\nAnalyze the following daily operational data for a government taskforce system and provide a DETAILED REPORT.\n\nDate: ".concat(e.date,"\n\nKey Metrics:\n- Total Reports Submitted: ").concat(e.metrics.totalComplaints,"\n- Pending Reports: ").concat(e.metrics.totalComplaints-e.metrics.resolvedComplaints,"\n- Resolution Rate: ").concat(e.performance.complaintResolutionRate,"%\n\n").concat(s,"\n").concat(t,"\n\nProvide a comprehensive analysis of the day's operations. **Ignore any word limits for this DETAILED REPORT.** Highlight key trends, successes, and areas of concern. Specifically, analyze the aggregated question-answer data, providing concrete examples from the \"Occurrences in Report IDs\" where applicable. For instance, if \"vehicle_separate_compartments\" was answered \"no\" in multiple reports, state \"vehicle separate compartments were not present in reports: ID1, ID5, ID10\". For each question, provide a summary of how many times each answer option was selected across all reports. For questions with 'yes/no' answers (e.g., 'scp_area_clean', 'waste_segregated', 'staff_present', 'workers_wearing_uniform', 'collection_team_mixing_waste', 'driver_helper_uniform', 'vehicle_separate_compartments'), explicitly state the count of 'yes' and 'no' responses across all reports. Discuss the implications of these findings and suggest detailed operational improvements. When summarizing question answers, focus on the counts of selected options and avoid phrasing that suggests a lack of effort or negative performance (e.g., instead of \"0% approved\", state \"X reports had 'Approved' status out of Y total\"). Ensure the summary is objective and data-driven.\n    ")}static buildConcisePrompt(e){let t=this.aggregateQuestionAnswers(e.rawReports);return"\nAnalyze the following daily operational data for a government taskforce system and provide a CONCISE SUMMARY.\n\nDate: ".concat(e.date,"\n\nKey Metrics:\n- Total Reports Submitted: ").concat(e.metrics.totalComplaints,"\n- Pending Reports: ").concat(e.metrics.totalComplaints-e.metrics.resolvedComplaints,"\n- Resolution Rate: ").concat(e.performance.complaintResolutionRate,"%\n\n").concat(t,"\n\nProvide a summary of the day's operations, approximately 300 words. This summary should capture the most important aspects of the detailed report, including overall performance, key challenges (like waste segregation issues or lack of vehicle separate compartments), and high-level recommendations. It should be suitable for a high-level overview for a minister. Ensure the summary incorporates the aggregated question-answer analysis and adheres to the phrasing guidelines for sensitive metrics, focusing on factual counts and specific examples from the reports rather than evaluative percentages that might be misinterpreted.\n    ")}static simulateAnalysis(e){let t=e.performance.complaintResolutionRate,s=e.metrics.totalComplaints,a=e.metrics.resolvedComplaints,n=s-a,r="",i=[];e.rawReports.forEach(e=>{var t;let s=e.answers.find(e=>"waste_segregated"===e.questionId);s&&("no"===s.answer||(null===(t=s.notes)||void 0===t?void 0:t.toLowerCase().includes("mixed")))&&i.push(e.feederPointName)}),i.length>0&&(r="\n\nWaste Segregation Analysis:\nObservations indicate that waste segregation is a recurring issue. Specifically, feeder points such as ".concat(i.join(", ")," reported instances of mixed waste. This impacts processing efficiency and environmental compliance."));let o=new Map;e.rawReports.forEach(e=>{e.answers.forEach(t=>{let{questionId:s,answer:a,notes:n}=t;o.has(s)||o.set(s,new Map);let r=o.get(s);r.has(a)||r.set(a,{count:0,reportIds:[],notes:[]});let i=r.get(a);i.count++,i.reportIds.push(e.id),n&&i.notes.push("Report ".concat(e.id,": ").concat(n))})});let l="Numerical Summary of Key Questions:\n";["scp_area_clean","waste_segregated","staff_present","workers_wearing_uniform","collection_team_mixing_waste","driver_helper_uniform","vehicle_separate_compartments"].forEach(e=>{let t=o.get(e);if(t){var s,a;let n=(null===(s=t.get("yes"))||void 0===s?void 0:s.count)||0,r=(null===(a=t.get("no"))||void 0===a?void 0:a.count)||0,i=e.replace(/_/g," ");l+='For "'.concat(i,'": ').concat(n," reports answered 'yes' and ").concat(r," reports answered 'no'.\n")}});let c="\n".concat(l,"\nDETAILED REPORT:\n\nComprehensive Daily Operational Analysis for ").concat(e.date,"\n\nOverall Performance:\nToday's operations saw a total of ").concat(s," compliance reports submitted. Of these, ").concat(a," were approved, resulting in a resolution rate of ").concat(t,"%. ").concat(n," reports remain pending, requiring further review.\n\nKey Insights and Trends:\n").concat(r,"\n\nOperational Efficiency:\nThe current operational efficiency is being impacted by inconsistent waste segregation practices. Addressing this will streamline waste processing and improve overall compliance.\n\nRecommendations:\n1. Implement targeted training for field teams on waste segregation protocols.\n2. Conduct surprise inspections at feeder points identified with segregation issues.\n3. Enhance monitoring mechanisms to identify and address non-compliance promptly.\n"),d="\nDaily Operational Summary for ".concat(e.date,"\n\nToday's operations processed ").concat(s," compliance reports, with a ").concat(t,"% approval rate. A primary challenge identified is inconsistent waste segregation, particularly at feeder points like ").concat(i.join(", "),". This issue requires immediate attention to improve processing efficiency and environmental adherence. Recommendations include targeted training and enhanced monitoring. Overall, the system demonstrates capacity, but specific operational adjustments are needed to optimize waste management practices and ensure full compliance with environmental standards. The taskforce continues to monitor and adapt to daily operational challenges, striving for continuous improvement in urban waste management. Further efforts will focus on reinforcing best practices and leveraging technology for better oversight. This summary provides a high-level overview for ministerial review, highlighting key performance indicators and areas requiring strategic intervention to maintain and enhance public service delivery.\n    ");return{detailed:c,summary:d}}static generateTrendAnalysis(e){let t=[],s=e.rawReports.filter(e=>{var t;let s=e.answers.find(e=>"waste_segregated"===e.questionId);return s&&("no"===s.answer||(null===(t=s.notes)||void 0===t?void 0:t.toLowerCase().includes("mixed")))});return s.length>e.rawReports.length/2?t.push("\uD83D\uDCC9 WASTE SEGREGATION: Significant trend of mixed waste observed across feeder points."):s.length>0?t.push("⚠️ WASTE SEGREGATION: Some instances of mixed waste reported, requiring attention."):t.push("✅ WASTE SEGREGATION: Generally good compliance with waste segregation today."),e.performance.userGrowth>5?t.push("\uD83D\uDCC8 USER GROWTH: Strong upward trend in new registrations"):e.performance.userGrowth>0&&t.push("\uD83D\uDCCA USER GROWTH: Steady growth in user base"),e.performance.complaintResolutionRate>85?t.push("✅ SERVICE QUALITY: High resolution rate maintained"):e.performance.complaintResolutionRate>70&&t.push("⚠️ SERVICE QUALITY: Resolution rate within acceptable range"),e.metrics.activeFeederPoints>10&&t.push("\uD83D\uDDFA️ COVERAGE: Comprehensive monitoring network active"),t.join("\n")||"\uD83D\uDCCA STABLE: All metrics within normal operational parameters"}static generateRecommendations(e){let t=[],s=e.rawReports.filter(e=>{var t;let s=e.answers.find(e=>"waste_segregated"===e.questionId);return s&&("no"===s.answer||(null===(t=s.notes)||void 0===t?void 0:t.toLowerCase().includes("mixed")))});return s.length>0&&(t.push("• Implement targeted training for field teams on waste segregation protocols."),t.push("• Conduct surprise inspections at feeder points identified with segregation issues."),t.push("• Enhance monitoring mechanisms to identify and address non-compliance promptly.")),e.performance.complaintResolutionRate<80&&(t.push("• Focus on improving complaint resolution processes"),t.push("• Consider additional training for response teams")),e.performance.userGrowth>10&&(t.push("• Prepare for increased system load due to user growth"),t.push("• Consider expanding monitoring capacity")),e.metrics.totalComplaints>20&&(t.push("• Analyze complaint patterns for preventive measures"),t.push("• Review resource allocation for high-volume areas")),0===t.length&&(t.push("• Continue current operational protocols"),t.push("• Maintain regular monitoring and assessment schedules"),t.push("• Prepare for potential scaling requirements")),t.join("\n")}};AIService.API_KEY="AIzaSyCfWiMcH2t-dC0K1xh1ZTSD_YYxVolvDLI",AIService.genAI=new A.$D(AIService.API_KEY);var I=s(7179);let R=i()(()=>Promise.all([s.e(726),s.e(265)]).then(s.bind(s,1265)).then(e=>e.StatusPieChart),{loadableGenerated:{webpack:()=>[1265]},ssr:!1});function DailyReportsPage(){var e,t,s;let{user:r}=(0,I.a)(),[i,A]=(0,n.useState)([]),[C,E]=(0,n.useState)(new Date().toISOString().split("T")[0]),[S,D]=(0,n.useState)(!1),[P,k]=(0,n.useState)(new Date().toISOString().split("T")[0]),[T,O]=(0,n.useState)(new Date().toISOString().split("T")[0]),[U,_]=(0,n.useState)(!1),[L,F]=(0,n.useState)("all"),[M,q]=(0,n.useState)(!1),[J,Z]=(0,n.useState)(null),[z,G]=(0,n.useState)(""),[B,Y]=(0,n.useState)(!1),[K,V]=(0,n.useState)(null),[X,Q]=(0,n.useState)(null),[W,H]=(0,n.useState)(null),[$,ee]=(0,n.useState)(null),[et,es]=(0,n.useState)(null),[ea,en]=(0,n.useState)({}),[er,ei]=(0,n.useState)({}),[eo,el]=(0,n.useState)(!1),[ec,ed]=(0,n.useState)([]),[em,ep]=(0,n.useState)(0),[eu,eh]=(0,n.useState)([]),parseAiSummaryForChart=e=>{let t;if(!e)return[];let s=[],a=/For "([^"]+)": (\d+) reports answered 'yes' and (\d+) reports answered 'no'/g,n=["#22c55e","#ef4444","#f59e0b","#3b82f6","#8b5cf6","#ec4899","#10b981","#d946ef","#f97316","#6366f1","#be185d","#0ea5e9"],r=0;for(;null!==(t=a.exec(e));){let e=t[1].replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),a=parseInt(t[2],10),i=parseInt(t[3],10);a>0&&(s.push({name:"".concat(e," (Yes)"),value:a,color:n[r%n.length]}),r++),i>0&&(s.push({name:"".concat(e," (No)"),value:i,color:n[r%n.length]}),r++)}return s},eg=(0,n.useMemo)(()=>K?[{name:"Pending",value:K.pending,color:"#f59e0b"},{name:"Approved",value:K.approved,color:"#22c55e"},{name:"Rejected",value:K.rejected,color:"#ef4444"},{name:"Action Required",value:K.actionRequired,color:"#f97316"}]:[],[K]),ex=(0,n.useMemo)(()=>eg.filter(e=>e.value>0),[eg]),ef=ex.length>0;(0,n.useEffect)(()=>{eh(parseAiSummaryForChart(W))},[W]),(0,n.useEffect)(()=>{if(J){en({}),ei({});return}es(null),el(!1),ed([]),ep(0),en({}),ei({})},[J]),(0,n.useEffect)(()=>{_(!0);let e=N.D.onComplianceReportsChange(e=>{console.log("All Compliance Reports (real-time):",e);let t=e.filter(e=>{let t=new Date(e.submittedAt.toDate()).toISOString().split("T")[0];if(S&&P&&T){let[e,s]=P<=T?[P,T]:[T,P];return t>=e&&t<=s}return t===C});"all"!==L&&(t=t.filter(e=>e.status===L)),console.log("Filtered Compliance Reports (real-time):",t),A(t);let s={total:t.length,pending:t.filter(e=>"pending"===e.status).length,approved:t.filter(e=>"approved"===e.status).length,rejected:t.filter(e=>"rejected"===e.status).length,actionRequired:t.filter(e=>"requires_action"===e.status).length};V(s),_(!1)});return()=>e()},[C,L,S,P,T]),(0,n.useEffect)(()=>{S||(k(C),O(C))},[C,S]),(0,n.useEffect)(()=>{let handleKeyPress=e=>{if(et)switch(e.key){case"ArrowLeft":e.preventDefault(),navigateImage("prev");break;case"ArrowRight":e.preventDefault(),navigateImage("next");break;case"Escape":e.preventDefault(),closeImageModal();break;case"g":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),openCollage())}};if(et)return document.addEventListener("keydown",handleKeyPress),()=>document.removeEventListener("keydown",handleKeyPress)},[et,ec,em]);let handleImageLoad=e=>{en(t=>({...t,[e]:!1}))},handleImageError=e=>{en(t=>({...t,[e]:!1})),ei(t=>({...t,[e]:!0}))},openImageModal=e=>{if(J){let t=[];J.answers.forEach((e,s)=>{e.photos&&e.photos.forEach((s,a)=>{t.push({url:s,title:"Question ".concat(e.questionId," - Photo ").concat(a+1),type:"answer"})})}),J.attachments&&J.attachments.forEach(e=>{"photo"===e.type&&t.push({url:e.url,title:e.filename,type:"attachment"})}),ed(t);let s=t.findIndex(t=>t.url===e);ep(s>=0?s:0)}ei(t=>{let s={...t};return delete s[e],s}),en(t=>({...t,[e]:!0})),es(e)},closeImageModal=()=>{es(null),el(!1)},navigateImage=e=>{if(0===ec.length)return;let t=em;ep(t="prev"===e?em>0?em-1:ec.length-1:em<ec.length-1?em+1:0),es(ec[t].url)},openCollage=()=>{el(!0)},selectImageFromCollage=e=>{let t=ec.findIndex(t=>t.url===e);ep(t>=0?t:0),es(e),el(!1)},handleStartDateChange=e=>{k(e),T&&e>T&&O(e)},handleEndDateChange=e=>{O(e),P&&e<P&&k(e)},handleUpdateStatus=async e=>{if(J&&r){Y(!0);try{await N.D.updateComplianceReportStatus(J.id,e,z,r.name),alert("Report ".concat(e," successfully")),Z(null),G("")}catch(e){console.error("❌ Error updating report status:",e),alert("Failed to update report status")}finally{Y(!1)}}},generateDailyAIAnalysis=async e=>{if(K){q(!0),ee(e);try{let t=C;if(S&&P&&T){let[e,s]=P<=T?[P,T]:[T,P];t="".concat(e," to ").concat(s)}let s={date:t,metrics:{totalUsers:0,newRegistrations:0,totalComplaints:K.total,resolvedComplaints:K.approved,activeFeederPoints:0,completedInspections:K.approved},performance:{complaintResolutionRate:K.total>0?Math.round(K.approved/K.total*100):0,userGrowth:0,operationalEfficiency:0},rawReports:i},{detailed:a,summary:n}=await AIService.generateAnalysis(s);"detailed"===e?(Q(a),H(null)):(H(n),Q(null)),alert("\uD83E\uDD16 Daily AI Analysis completed successfully!")}catch(e){console.error("Error generating daily AI analysis:",e),alert("❌ Error generating daily AI analysis. Please try again.")}finally{q(!1)}}},getStatusColor=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";case"requires_action":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}},getStatusIcon=e=>{switch(e){case"pending":return(0,a.jsx)(o.Z,{className:"h-5 w-5 text-yellow-600"});case"approved":return(0,a.jsx)(l.Z,{className:"h-5 w-5 text-green-600"});case"rejected":return(0,a.jsx)(c.Z,{className:"h-5 w-5 text-red-600"});case"requires_action":return(0,a.jsx)(d.Z,{className:"h-5 w-5 text-orange-600"});default:return(0,a.jsx)(o.Z,{className:"h-5 w-5 text-gray-600"})}};return U?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):(0,a.jsxs)("div",{className:"space-y-6 scrollable-content",children:[(0,a.jsx)("div",{className:"border-b border-gray-200 pb-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(m.Z,{className:"h-8 w-8 text-blue-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"Daily Reports"}),(0,a.jsx)("p",{className:"mt-1 text-sm sm:text-base text-gray-600",children:"View daily reports from the field."})]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-end gap-3",children:[(0,a.jsxs)("label",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[(0,a.jsx)("input",{type:"checkbox",checked:S,onChange:()=>{if(S){let e=P||new Date().toISOString().split("T")[0];E(e)}else k(C),O(C);D(!S)},className:"h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),(0,a.jsx)("span",{children:"Custom Range"})]}),S?(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{type:"date",value:P,onChange:e=>handleStartDateChange(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"to"}),(0,a.jsx)("input",{type:"date",value:T,onChange:e=>handleEndDateChange(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]}):(0,a.jsx)("input",{type:"date",value:C,onChange:e=>E(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"}),(0,a.jsxs)("div",{className:"relative",children:[" ",(0,a.jsxs)("select",{value:L,onChange:e=>F(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",children:[(0,a.jsx)("option",{value:"all",children:"All Reports"}),(0,a.jsx)("option",{value:"pending",children:"Pending"}),(0,a.jsx)("option",{value:"approved",children:"Approved"}),(0,a.jsx)("option",{value:"rejected",children:"Rejected"}),(0,a.jsx)("option",{value:"requires_action",children:"Action Required"})]})]})]})]})}),K&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"card p-4 text-center",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-700",children:"Total Reports"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-blue-600",children:K.total})]}),(0,a.jsxs)("div",{className:"card p-4 text-center",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-700",children:"Pending"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-yellow-600",children:K.pending})]}),(0,a.jsxs)("div",{className:"card p-4 text-center",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-700",children:"Approved"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-green-600",children:K.approved})]}),(0,a.jsxs)("div",{className:"card p-4 text-center",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-700",children:"Rejected"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-red-600",children:K.rejected})]})]}),(0,a.jsxs)("div",{className:"card p-4",children:[(0,a.jsx)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Report Status Distribution"}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Breakdown of report statuses for the selected ",S?"date range":"date","."]})]})}),ef?(0,a.jsxs)("div",{className:"mt-6 grid grid-cols-1 gap-8 lg:grid-cols-2",children:[(0,a.jsx)(R,{data:ex}),(0,a.jsx)("div",{className:"space-y-4",children:eg.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between rounded-lg border border-gray-100 p-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("span",{className:"h-3 w-3 rounded-full",style:{backgroundColor:e.color}}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:e.name})]}),(0,a.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:e.value})]},e.name))})]}):(0,a.jsxs)("p",{className:"mt-6 text-sm text-gray-500",children:["No reports available for the selected ",S?"date range.":"date."]})]})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-6",children:(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Daily AI Analysis"}),(0,a.jsxs)("div",{className:"flex space-x-2 mb-4",children:[(0,a.jsxs)("button",{onClick:()=>generateDailyAIAnalysis("detailed"),disabled:M||!K||0===K.total,className:"flex-1 btn-secondary flex items-center justify-center space-x-2",children:[(0,a.jsx)(p.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:M&&"detailed"===$?"Analyzing...":"Generate Detailed AI Analysis"})]}),(0,a.jsxs)("button",{onClick:()=>generateDailyAIAnalysis("summary"),disabled:M||!K||0===K.total,className:"flex-1 btn-secondary flex items-center justify-center space-x-2",children:[(0,a.jsx)(p.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:M&&"summary"===$?"Analyzing...":"Generate Concise AI Summary"})]})]}),X&&"detailed"===$&&(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 mb-4",children:[(0,a.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-2",children:"Detailed Report:"}),(0,a.jsx)("pre",{className:"whitespace-pre-wrap text-sm text-gray-800 font-sans",children:X}),(0,a.jsxs)("button",{onClick:()=>{if(X){let e=new Blob([X],{type:"text/plain"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="Daily_AI_Detailed_Analysis_".concat(C,".txt"),document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t)}},className:"w-full btn-secondary flex items-center justify-center space-x-2 mt-4",children:[(0,a.jsx)(u.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Download Detailed AI Report"})]})]}),W&&"summary"===$&&(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,a.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-2",children:"Concise Summary:"}),(0,a.jsx)("pre",{className:"whitespace-pre-wrap text-sm text-gray-800 font-sans",children:W}),eu.length>0&&(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsx)("h4",{className:"text-md font-semibold text-gray-900 mb-2",children:"Summary Breakdown:"}),(0,a.jsxs)("div",{className:"mt-6 grid grid-cols-1 gap-8 lg:grid-cols-2",children:[(0,a.jsx)(R,{data:eu}),(0,a.jsx)("div",{className:"space-y-4",children:eu.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between rounded-lg border border-gray-100 p-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("span",{className:"h-3 w-3 rounded-full",style:{backgroundColor:e.color}}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:e.name})]}),(0,a.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:e.value})]},e.name))})]})]}),(0,a.jsxs)("button",{onClick:()=>{if(W){let e=new Blob([W],{type:"text/plain"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="Daily_AI_Concise_Summary_".concat(C,".txt"),document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t)}},className:"w-full btn-secondary flex items-center justify-center space-x-2 mt-4",children:[(0,a.jsx)(u.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Download Concise AI Summary"})]})]})]})}),(0,a.jsx)("div",{className:"space-y-4",children:i.length>0?i.map(e=>(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"p-2 rounded-full ".concat(getStatusColor(e.status)),children:getStatusIcon(e.status)}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:[e.feederPointName," - Trip ",e.tripNumber]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Submitted by ",e.userName," (",e.teamName,")"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:new Date(e.submittedAt.toDate()).toLocaleDateString()}),(0,a.jsx)("button",{onClick:()=>Z(e),className:"btn-secondary p-2",children:(0,a.jsx)(h.Z,{className:"h-5 w-5"})})]})]}),(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("p",{className:"text-sm text-gray-700",children:e.description}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[(()=>{let t=e.answers.reduce((e,t)=>e+(t.photos?t.photos.length:0),0),s=e.attachments?e.attachments.length:0,n=t+s;return n>0?(0,a.jsxs)("span",{className:"flex items-center",children:[(0,a.jsx)(g.Z,{className:"h-3 w-3 mr-1"}),n," image",1!==n?"s":""]}):null})(),(0,a.jsxs)("span",{className:"flex items-center",children:[(0,a.jsx)(x.Z,{className:"h-3 w-3 mr-1"}),e.answers.length," answer",1!==e.answers.length?"s":""]})]}),(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-semibold ".concat(getStatusColor(e.status)),children:e.status.replace("_"," ").toUpperCase()})]})]})]},e.id)):(0,a.jsxs)("div",{className:"card text-center py-12",children:[(0,a.jsx)(m.Z,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Reports Found"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"No reports were found for the selected date."})]})}),J&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-2xl p-6 w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold text-gray-900",children:[J.feederPointName," - Trip ",J.tripNumber]}),(0,a.jsx)("button",{onClick:()=>Z(null),className:"p-2",children:(0,a.jsx)(c.Z,{className:"h-6 w-6 text-gray-600"})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Details"}),(0,a.jsxs)("div",{className:"space-y-2 text-sm text-gray-700",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Submitted By:"})," ",J.userName," (",J.teamName,")"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Feeder Point:"})," ",J.feederPointName]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Submitted At:"})," ",new Date(J.submittedAt.toDate()).toLocaleString()]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Status:"})," ",(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-semibold ".concat(getStatusColor(J.status)),children:J.status})]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Priority:"})," ",(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-semibold ".concat("high"===J.priority?"bg-red-100 text-red-800":"medium"===J.priority?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"),children:J.priority})]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Trip Date:"})," ",J.tripDate]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Trip Number:"})," ",J.tripNumber]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Location:"})," ",J.submittedLocation.address," (",J.distanceFromFeederPoint.toFixed(2),"m from FP)"]})]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Description"}),(0,a.jsx)("p",{className:"text-sm text-gray-700",children:J.description})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Answers"}),(0,a.jsx)("div",{className:"space-y-4",children:J.answers.map((e,t)=>(0,a.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-gray-900 mb-1",children:["Q: ",e.questionId]}),(0,a.jsxs)("p",{className:"text-sm text-gray-700 mb-2",children:["A: ",e.answer]}),e.notes&&(0,a.jsxs)("p",{className:"text-xs text-gray-600 mb-3 italic",children:["Notes: ",e.notes]}),e.photos&&e.photos.length>0&&(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsxs)("p",{className:"text-xs font-medium text-gray-700 mb-2 flex items-center",children:[(0,a.jsx)(g.Z,{className:"h-3 w-3 mr-1"}),"Photos (",e.photos.length,")"]}),(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:e.photos.map((t,s)=>(0,a.jsxs)("div",{className:"relative group",children:[!1!==ea[t]&&!er[t]&&(0,a.jsx)("div",{className:"absolute inset-0 bg-gray-200 rounded-md flex items-center justify-center z-10",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"})}),er[t]?(0,a.jsx)("div",{className:"w-full h-20 bg-gray-200 rounded-md flex items-center justify-center border-2 border-dashed border-gray-300",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(g.Z,{className:"h-6 w-6 text-gray-400 mx-auto mb-1"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Failed to load"})]})}):(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("img",{src:t,alt:"Photo ".concat(s+1," for question ").concat(e.questionId),className:"w-full h-20 object-cover rounded-md cursor-pointer hover:opacity-90 transition-opacity",onLoad:()=>handleImageLoad(t),onError:()=>handleImageError(t),onClick:()=>openImageModal(t)}),(0,a.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-200 rounded-md flex items-center justify-center",children:(0,a.jsx)(f.Z,{className:"h-4 w-4 text-white opacity-0 group-hover:opacity-100 transition-opacity"})})]})]},s))})]})]},t))})]}),(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-2 flex items-center",children:[(0,a.jsx)(g.Z,{className:"h-5 w-5 mr-2"}),"Attachments",J.attachments&&J.attachments.length>0&&(0,a.jsxs)("span",{className:"ml-2 text-sm text-gray-500",children:["(",J.attachments.length,")"]})]}),(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4",children:J.attachments&&J.attachments.length>0?J.attachments.map(e=>(0,a.jsx)("div",{className:"relative group",children:"photo"===e.type?(0,a.jsxs)(a.Fragment,{children:[!1!==ea[e.url]&&!er[e.url]&&(0,a.jsx)("div",{className:"absolute inset-0 bg-gray-200 rounded-lg flex items-center justify-center z-10",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}),er[e.url]?(0,a.jsx)("div",{className:"w-full h-32 bg-gray-200 rounded-lg flex items-center justify-center border-2 border-dashed border-gray-300",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(g.Z,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Failed to load"}),(0,a.jsx)("p",{className:"text-xs text-gray-400",children:e.filename})]})}):(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("img",{src:e.url,alt:e.filename,className:"w-full h-32 object-cover rounded-lg cursor-pointer hover:opacity-90 transition-opacity",onLoad:()=>handleImageLoad(e.url),onError:()=>handleImageError(e.url),onClick:()=>openImageModal(e.url)}),(0,a.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-200 rounded-lg flex items-center justify-center",children:(0,a.jsx)(f.Z,{className:"h-6 w-6 text-white opacity-0 group-hover:opacity-100 transition-opacity"})}),(0,a.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white text-xs p-2 rounded-b-lg opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,a.jsx)("p",{className:"truncate",children:e.filename}),(0,a.jsx)("p",{className:"text-gray-300",children:new Date(e.uploadedDate).toLocaleDateString()})]})]})]}):(0,a.jsx)("div",{className:"w-full h-32 bg-gray-100 rounded-lg flex items-center justify-center border border-gray-300 hover:bg-gray-200 transition-colors cursor-pointer",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(m.Z,{className:"h-8 w-8 text-gray-500 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-xs text-gray-700 font-medium",children:e.type.toUpperCase()}),(0,a.jsx)("p",{className:"text-xs text-gray-500 truncate max-w-full px-2",children:e.filename}),(0,a.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center mt-1 text-xs text-blue-600 hover:text-blue-800",onClick:e=>e.stopPropagation(),children:[(0,a.jsx)(y.Z,{className:"h-3 w-3 mr-1"}),"Open"]})]})})},e.id)):(0,a.jsxs)("div",{className:"col-span-2 sm:col-span-3 text-center py-8",children:[(0,a.jsx)(g.Z,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"No attachments found for this report."})]})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Admin Notes"}),(0,a.jsx)("textarea",{className:"w-full p-2 border border-gray-300 rounded-md text-sm",rows:4,value:z,onChange:e=>G(e.target.value),placeholder:"Add notes for this report..."})]}),(0,a.jsxs)("div",{className:"card mt-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Actions"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsxs)("button",{onClick:()=>handleUpdateStatus("approved"),disabled:B,className:"w-full btn-primary flex items-center justify-center space-x-2",children:[(0,a.jsx)(l.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:B?"Approving...":"Approve"})]}),(0,a.jsxs)("button",{onClick:()=>handleUpdateStatus("rejected"),disabled:B,className:"w-full btn-secondary flex items-center justify-center space-x-2 bg-red-500 hover:bg-red-600 text-white",children:[(0,a.jsx)(c.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:B?"Rejecting...":"Reject"})]}),(0,a.jsxs)("button",{onClick:()=>handleUpdateStatus("requires_action"),disabled:B,className:"w-full btn-secondary flex items-center justify-center space-x-2 bg-orange-500 hover:bg-orange-600 text-white",children:[(0,a.jsx)(d.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:B?"Updating...":"Action Required"})]})]})]})]})]})]})}),et&&(0,a.jsxs)("div",{className:"fixed inset-0 bg-black bg-opacity-95 flex items-center justify-center z-50",children:[(0,a.jsxs)("div",{className:"relative w-full h-full flex flex-col",children:[(0,a.jsx)("div",{className:"absolute top-0 left-0 right-0 z-20 bg-gradient-to-b from-black/70 to-transparent p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between text-white",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:(null===(e=ec[em])||void 0===e?void 0:e.title)||"Image"}),ec.length>1&&(0,a.jsxs)("span",{className:"text-sm text-gray-300",children:[em+1," of ",ec.length]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[ec.length>1&&(0,a.jsx)("button",{onClick:openCollage,className:"bg-black/50 hover:bg-black/70 rounded-full p-2 transition-colors",title:"View all images",children:(0,a.jsx)(b.Z,{className:"h-5 w-5"})}),(0,a.jsx)("a",{href:et,target:"_blank",rel:"noopener noreferrer",className:"bg-black/50 hover:bg-black/70 rounded-full p-2 transition-colors",title:"Open original",children:(0,a.jsx)(y.Z,{className:"h-5 w-5"})}),(0,a.jsx)("button",{onClick:closeImageModal,className:"bg-black/50 hover:bg-black/70 rounded-full p-2 transition-colors",children:(0,a.jsx)(c.Z,{className:"h-5 w-5"})})]})]})}),(0,a.jsxs)("div",{className:"flex-1 flex items-center justify-center p-4 pt-20 pb-20",children:[ec.length>1&&(0,a.jsx)("button",{onClick:()=>navigateImage("prev"),className:"absolute left-4 top-1/2 transform -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors z-10",children:(0,a.jsx)(v.Z,{className:"h-6 w-6"})}),(0,a.jsxs)("div",{className:"relative max-w-full max-h-full",children:[et&&!1!==ea[et]&&!er[et]&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white"})}),et&&er[et]?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center bg-black/60 text-white px-6 py-8 rounded-lg",onClick:e=>e.stopPropagation(),children:[(0,a.jsx)(g.Z,{className:"h-12 w-12 mb-3 text-white/70"}),(0,a.jsx)("p",{className:"text-sm text-center",children:"Unable to load image. Please try opening the original file."})]}):(0,a.jsx)("img",{src:et||"",alt:(null===(t=ec[em])||void 0===t?void 0:t.title)||"Full size view",className:"max-w-full max-h-full object-contain rounded-lg shadow-2xl ".concat(et&&!1!==ea[et]?"opacity-0":"opacity-100"," transition-opacity duration-200"),onLoad:()=>et&&handleImageLoad(et),onError:()=>et&&handleImageError(et),onClick:e=>e.stopPropagation()})]}),ec.length>1&&(0,a.jsx)("button",{onClick:()=>navigateImage("next"),className:"absolute right-4 top-1/2 transform -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors z-10",children:(0,a.jsx)(j.Z,{className:"h-6 w-6"})})]}),(0,a.jsx)("div",{className:"absolute bottom-0 left-0 right-0 z-20 bg-gradient-to-t from-black/70 to-transparent p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between text-white",children:[(0,a.jsx)("div",{className:"flex items-center space-x-4",children:(0,a.jsxs)("span",{className:"text-sm text-gray-300",children:["Type: ",(null===(s=ec[em])||void 0===s?void 0:s.type)==="answer"?"Answer Photo":"Attachment"]})}),(0,a.jsx)("div",{className:"flex items-center space-x-2",children:ec.length>1&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>navigateImage("prev"),className:"bg-black/50 hover:bg-black/70 rounded px-3 py-1 text-sm transition-colors",children:"Previous"}),(0,a.jsx)("button",{onClick:()=>navigateImage("next"),className:"bg-black/50 hover:bg-black/70 rounded px-3 py-1 text-sm transition-colors",children:"Next"})]})})]})}),ec.length>1&&(0,a.jsx)("div",{className:"absolute bottom-16 left-1/2 transform -translate-x-1/2 text-white/60 text-xs",children:"Use ← → arrow keys to navigate"})]}),(0,a.jsx)("div",{className:"absolute inset-0 -z-10",onClick:closeImageModal})]}),eo&&ec.length>0&&(0,a.jsxs)("div",{className:"fixed inset-0 bg-black bg-opacity-95 flex items-center justify-center z-60",children:[(0,a.jsxs)("div",{className:"relative w-full h-full max-w-7xl mx-auto p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-white mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"All Images"}),(0,a.jsxs)("p",{className:"text-gray-300",children:[ec.length," images from this report"]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("button",{onClick:()=>el(!1),className:"bg-black/50 hover:bg-black/70 rounded-full p-2 transition-colors",title:"Back to single view",children:(0,a.jsx)(w.Z,{className:"h-5 w-5"})}),(0,a.jsx)("button",{onClick:closeImageModal,className:"bg-black/50 hover:bg-black/70 rounded-full p-2 transition-colors",children:(0,a.jsx)(c.Z,{className:"h-5 w-5"})})]})]}),(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 max-h-[calc(100vh-120px)] overflow-y-auto",children:ec.map((e,t)=>(0,a.jsx)("div",{className:"relative group cursor-pointer rounded-lg overflow-hidden transition-all duration-200 ".concat(t===em?"ring-4 ring-blue-500 ring-opacity-75 scale-105":"hover:scale-105 hover:ring-2 hover:ring-white/50"),onClick:()=>selectImageFromCollage(e.url),children:(0,a.jsxs)("div",{className:"aspect-square relative",children:[!1!==ea[e.url]&&!er[e.url]&&(0,a.jsx)("div",{className:"absolute inset-0 bg-gray-800 flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})}),er[e.url]?(0,a.jsx)("div",{className:"w-full h-full bg-gray-800 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center text-white",children:[(0,a.jsx)(g.Z,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),(0,a.jsx)("p",{className:"text-xs opacity-75",children:"Failed to load"})]})}):(0,a.jsx)("img",{src:e.url,alt:e.title,className:"w-full h-full object-cover",onLoad:()=>handleImageLoad(e.url),onError:()=>handleImageError(e.url)}),(0,a.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-200 flex items-center justify-center",children:(0,a.jsx)(f.Z,{className:"h-6 w-6 text-white opacity-0 group-hover:opacity-100 transition-opacity"})}),(0,a.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,a.jsx)("p",{className:"text-white text-xs font-medium truncate",children:e.title}),(0,a.jsx)("p",{className:"text-gray-300 text-xs",children:"answer"===e.type?"Answer Photo":"Attachment"})]}),t===em&&(0,a.jsx)("div",{className:"absolute top-2 right-2 bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold",children:"✓"})]})},t))}),(0,a.jsx)("div",{className:"flex items-center justify-center mt-6 text-white/60 text-sm",children:"Click on any image to view it in full screen"})]}),(0,a.jsx)("div",{className:"absolute inset-0 -z-10",onClick:closeImageModal})]})]})}}},function(e){e.O(0,[16,868,630,774,888,179],function(){return e(e.s=8795)}),_N_E=e.O()}]);