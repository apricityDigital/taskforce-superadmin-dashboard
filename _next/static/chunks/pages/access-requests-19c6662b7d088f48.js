(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[939],{3756:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});var a=s(4297);let r=(0,a.Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},5077:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});var a=s(4297);let r=(0,a.Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},4464:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});var a=s(4297);let r=(0,a.Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},7401:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/access-requests",function(){return s(6075)}])},5140:function(e,t,s){"use strict";s.d(t,{D:function(){return DataService}});var a=s(9828),r=s(7889);let DataService=class DataService{static async getDashboardStats(){try{let[e,t,s,c,i,l,d,n]=await Promise.all([(0,a.PL)((0,a.hJ)(r.db,"approvedUsers")),(0,a.PL)((0,a.IO)((0,a.hJ)(r.db,"approvedUsers"),(0,a.ar)("isActive","==",!0))),(0,a.PL)((0,a.IO)((0,a.hJ)(r.db,"accessRequests"),(0,a.ar)("status","==","pending"))),(0,a.PL)((0,a.hJ)(r.db,"complianceReports")),(0,a.PL)((0,a.hJ)(r.db,"inspections")),(0,a.PL)((0,a.hJ)(r.db,"feederPoints")),(0,a.PL)((0,a.hJ)(r.db,"teams")),(0,a.PL)((0,a.hJ)(r.db,"ipRecords"))]),o=e.docs.map(e=>({id:e.id,...e.data()})),m=t.docs.map(e=>({id:e.id,...e.data()})),h=o.filter(e=>"admin"===e.role).length,u=o.filter(e=>"task_force_team"===e.role).length,p=o.filter(e=>"commissioner"===e.role).length,x=o.filter(e=>!e.isActive).length,g=m.filter(e=>"admin"===e.role).length,v=m.filter(e=>"task_force_team"===e.role).length,y=m.filter(e=>"commissioner"===e.role).length;return{totalUsers:e.size,activeUsers:t.size,pendingRequests:s.size,totalComplaints:c.size,totalInspections:i.size,totalFeederPoints:l.size,totalTeams:d.size,totalIPRecords:n.size,adminUsers:h,taskForceUsers:u,commissionerUsers:p,inactiveUsers:x,activeAdmins:g,activeTaskForce:v,activeCommissioners:y}}catch(e){return console.error("Error fetching dashboard stats:",e),{totalUsers:0,activeUsers:0,pendingRequests:0,totalComplaints:0,totalInspections:0,totalFeederPoints:0,totalTeams:0,totalIPRecords:0,adminUsers:0,taskForceUsers:0,commissionerUsers:0,inactiveUsers:0,activeAdmins:0,activeTaskForce:0,activeCommissioners:0}}}static onUsersChange(e){let t=(0,a.IO)((0,a.hJ)(r.db,"approvedUsers"),(0,a.Xo)("createdAt","desc"));return(0,a.cf)(t,t=>{let s=t.docs.map(e=>({id:e.id,...e.data()}));e(s)})}static async getAllUsers(){let e=(0,a.IO)((0,a.hJ)(r.db,"approvedUsers")),t=await (0,a.PL)(e),s=t.docs.map(e=>({id:e.id,...e.data()}));return s}static onAccessRequestsChange(e){let t=(0,a.IO)((0,a.hJ)(r.db,"accessRequests"),(0,a.Xo)("createdAt","desc"));return(0,a.cf)(t,t=>{let s=t.docs.map(e=>({id:e.id,...e.data()}));e(s)})}static onComplaintsChange(e){let t=(0,a.IO)((0,a.hJ)(r.db,"complaints"),(0,a.Xo)("createdAt","desc"));return(0,a.cf)(t,t=>{let s=t.docs.map(e=>({id:e.id,...e.data()}));e(s)})}static async getAllComplaints(){let e=(0,a.IO)((0,a.hJ)(r.db,"complaints")),t=await (0,a.PL)(e),s=t.docs.map(e=>({id:e.id,...e.data()}));return s}static async getAllComplianceReports(){let e=(0,a.IO)((0,a.hJ)(r.db,"complianceReports"),(0,a.Xo)("submittedAt","desc")),t=await (0,a.PL)(e),s=t.docs.map(e=>({id:e.id,...e.data()}));return s}static onComplianceReportsChange(e){let t=(0,a.IO)((0,a.hJ)(r.db,"complianceReports"),(0,a.Xo)("submittedAt","desc"));return(0,a.cf)(t,t=>{let s=t.docs.map(e=>({id:e.id,...e.data()}));e(s)})}static async updateComplianceReportStatus(e,t,s,c){try{let i={status:t,reviewedAt:(0,a.Bt)(),updatedAt:(0,a.Bt)()};s&&(i.adminNotes=s),c&&(i.reviewedBy=c),await (0,a.r7)((0,a.JU)(r.db,"complianceReports",e),i),console.log("✅ Compliance report status updated:",e,t)}catch(e){throw console.error("❌ Error updating compliance report status:",e),e}}static onIPRecordsChange(e){let t=(0,a.IO)((0,a.hJ)(r.db,"ipRecords"),(0,a.Xo)("registeredAt","desc"));return(0,a.cf)(t,t=>{let s=t.docs.map(e=>({id:e.id,...e.data()}));e(s)})}static onFeederPointsChange(e){let t=(0,a.IO)((0,a.hJ)(r.db,"feederPoints"));return(0,a.cf)(t,t=>{let s=t.docs.map(e=>({id:e.id,...e.data()}));e(s)})}static async getAllFeederPoints(){let e=(0,a.IO)((0,a.hJ)(r.db,"feederPoints")),t=await (0,a.PL)(e),s=t.docs.map(e=>({id:e.id,...e.data()}));return s}static onTeamsChange(e){let t=(0,a.IO)((0,a.hJ)(r.db,"teams"));return(0,a.cf)(t,t=>{let s=t.docs.map(e=>({id:e.id,...e.data()}));e(s)})}static async updateFeederPoint(e,t){let s=(0,a.JU)(r.db,"feederPoints",e);await (0,a.r7)(s,t)}static async createFeederPoint(e){let t=(0,a.hJ)(r.db,"feederPoints");await (0,a.pl)((0,a.JU)(t),e,{merge:!0})}static async deleteFeederPoint(e){let t=(0,a.JU)(r.db,"feederPoints",e);await (0,a.oe)(t)}static async createSampleFeederPoints(){let e=(0,a.hJ)(r.db,"feederPoints");for(let t of[{name:"FP-001",status:"active",priority:"high",location:{address:"123 Main St",latitude:34.0522,longitude:-118.2437}},{name:"FP-002",status:"maintenance",priority:"medium",location:{address:"456 Oak Ave",latitude:34.0522,longitude:-118.2437}},{name:"FP-003",status:"inactive",priority:"low",location:{address:"789 Pine Ln",latitude:34.0522,longitude:-118.2437}}])await (0,a.pl)((0,a.JU)(e),t)}static async getRecentActivity(){try{let e=(0,a.IO)((0,a.hJ)(r.db,"recentActivity"),(0,a.Xo)("timestamp","desc"),(0,a.b9)(10)),t=await (0,a.PL)(e),s=t.docs.map(e=>({id:e.id,...e.data()}));return s}catch(e){return console.error("Error fetching recent activity:",e),[]}}static async approveAccessRequest(e){try{let t=(0,a.JU)(r.db,"accessRequests",e.id);await (0,a.r7)(t,{status:"approved",reviewedAt:(0,a.Bt)(),reviewedBy:"AdminUserPlaceholder",updatedAt:(0,a.Bt)()}),console.log("✅ Access request approved:",e.id)}catch(e){throw console.error("❌ Error approving access request:",e),e}}static async rejectAccessRequest(e){try{let t=(0,a.JU)(r.db,"accessRequests",e);await (0,a.r7)(t,{status:"rejected",reviewedAt:(0,a.Bt)(),reviewedBy:"AdminUserPlaceholder",updatedAt:(0,a.Bt)()}),console.log("✅ Access request rejected:",e)}catch(e){throw console.error("❌ Error rejecting access request:",e),e}}static async updateComplaint(e,t){try{let s=(0,a.JU)(r.db,"complaints",e);await (0,a.r7)(s,{...t,updatedAt:(0,a.Bt)()}),console.log("✅ Complaint updated:",e)}catch(e){throw console.error("❌ Error updating complaint:",e),e}}static async deleteComplaint(e){try{await (0,a.oe)((0,a.JU)(r.db,"complaints",e)),console.log("✅ Complaint deleted:",e)}catch(e){throw console.error("❌ Error deleting complaint:",e),e}}static async testDatabaseConnection(){try{console.log("Attempting to fetch collections from Firestore...");let e=await Promise.all([(0,a.PL)((0,a.hJ)(r.db,"approvedUsers")),(0,a.PL)((0,a.hJ)(r.db,"accessRequests")),(0,a.PL)((0,a.hJ)(r.db,"complianceReports")),(0,a.PL)((0,a.hJ)(r.db,"feederPoints")),(0,a.PL)((0,a.hJ)(r.db,"teams"))]);return console.log("Successfully fetched collections:"),console.log("- approvedUsers: ".concat(e[0].size," documents")),console.log("- accessRequests: ".concat(e[1].size," documents")),console.log("- complianceReports: ".concat(e[2].size," documents")),console.log("- feederPoints: ".concat(e[3].size," documents")),console.log("- teams: ".concat(e[4].size," documents")),!0}catch(e){return console.error("Error testing database connection:",e),!1}}static async getUserReports(e){let t=(0,a.IO)((0,a.hJ)(r.db,"complianceReports"),(0,a.ar)("userId","==",e)),s=await (0,a.PL)(t);return s.docs.map(e=>({id:e.id,...e.data()}))}static async getUserFeederPoints(e){let t=(0,a.IO)((0,a.hJ)(r.db,"feederPoints"),(0,a.ar)("assignedUserId","==",e)),s=await (0,a.PL)(t);return s.docs.map(e=>({id:e.id,...e.data()}))}static async updateUser(e,t){let s=(0,a.JU)(r.db,"approvedUsers",e);await (0,a.r7)(s,t)}static async deleteUser(e){let t=(0,a.JU)(r.db,"approvedUsers",e);await (0,a.oe)(t)}}},7889:function(e,t,s){"use strict";s.d(t,{db:function(){return i}});var a=s(3977),r=s(9828);let c=(0,a.ZF)({apiKey:"AIzaSyAUl-1iNJo7MjMgKk_vBaBKeDNEYVSxSDE",authDomain:"task-force-b1ff7.firebaseapp.com",projectId:"task-force-b1ff7",storageBucket:"task-force-b1ff7.firebasestorage.app",messagingSenderId:"1029709761200",appId:"1:1029709761200:web:d051815003907ec7f14975"}),i=(0,r.ad)(c)},6075:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return AccessRequestsPage}});var a=s(5893),r=s(7294),c=s(5077),i=s(3756),l=s(4297);let d=(0,l.Z)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),n=(0,l.Z)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);var o=s(4464),m=s(5140);function AccessRequestsPage(){let[e,t]=(0,r.useState)([]),[s,l]=(0,r.useState)(!0),[h,u]=(0,r.useState)("all"),loadAccessRequests=()=>{l(!0);let e=m.D.onAccessRequestsChange(e=>{t(e),l(!1)});return e};(0,r.useEffect)(()=>{let e=loadAccessRequests();return()=>e()},[]);let handleApproveRequest=async e=>{if(confirm('Are you sure you want to approve the request for "'.concat(e.name,'"?')))try{await m.D.approveAccessRequest(e),alert("Request approved successfully!"),loadAccessRequests()}catch(e){console.error("Error approving request:",e),alert("Error approving request. Please try again.")}},handleRejectRequest=async e=>{if(confirm("Are you sure you want to reject this request?"))try{await m.D.rejectAccessRequest(e),alert("Request rejected successfully!"),loadAccessRequests()}catch(e){console.error("Error rejecting request:",e),alert("Error rejecting request. Please try again.")}},p=e.filter(e=>"all"===h||e.status===h),getStatusBadge=e=>({pending:"badge-warning",approved:"badge-success",rejected:"badge-danger"})[e]||"badge-info",getStatusIcon=e=>{switch(e){case"pending":default:return(0,a.jsx)(c.Z,{className:"h-4 w-4"});case"approved":return(0,a.jsx)(i.Z,{className:"h-4 w-4"});case"rejected":return(0,a.jsx)(d,{className:"h-4 w-4"})}},getRoleBadge=e=>({admin:"badge-danger",task_force_team:"badge-info",commissioner:"badge-warning"})[e]||"badge-info";if(s)return(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})});let x=e.filter(e=>"pending"===e.status).length,g=e.filter(e=>"approved"===e.status).length,v=e.filter(e=>"rejected"===e.status).length;return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"border-b border-gray-200 pb-4",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Access Requests"}),(0,a.jsxs)("p",{className:"mt-2 text-gray-600",children:["Review and manage user access requests (",e.length," total)"]})]}),(0,a.jsx)("div",{className:"flex space-x-3",children:(0,a.jsxs)("button",{className:"btn-primary flex items-center space-x-2",children:[(0,a.jsx)(n,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Bulk Approve"})]})})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,a.jsx)("div",{className:"stat-card",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"p-3 rounded-lg bg-warning-500",children:(0,a.jsx)(c.Z,{className:"h-6 w-6 text-white"})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Pending"}),(0,a.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:x})]})]})}),(0,a.jsx)("div",{className:"stat-card",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"p-3 rounded-lg bg-success-500",children:(0,a.jsx)(i.Z,{className:"h-6 w-6 text-white"})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Approved"}),(0,a.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:g})]})]})}),(0,a.jsx)("div",{className:"stat-card",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"p-3 rounded-lg bg-danger-500",children:(0,a.jsx)(d,{className:"h-6 w-6 text-white"})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Rejected"}),(0,a.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:v})]})]})}),(0,a.jsx)("div",{className:"stat-card",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"p-3 rounded-lg bg-primary-500",children:(0,a.jsx)(n,{className:"h-6 w-6 text-white"})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total"}),(0,a.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:e.length})]})]})})]}),(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Filter by status:"}),(0,a.jsxs)("select",{value:h,onChange:e=>u(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",children:[(0,a.jsx)("option",{value:"all",children:"All Status"}),(0,a.jsx)("option",{value:"pending",children:"Pending"}),(0,a.jsx)("option",{value:"approved",children:"Approved"}),(0,a.jsx)("option",{value:"rejected",children:"Rejected"})]})]})}),(0,a.jsxs)("div",{className:"table-container",children:[(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"table-header",children:"Applicant"}),(0,a.jsx)("th",{className:"table-header",children:"Contact"}),(0,a.jsx)("th",{className:"table-header",children:"Organization"}),(0,a.jsx)("th",{className:"table-header",children:"Requested Role"}),(0,a.jsx)("th",{className:"table-header",children:"Status"}),(0,a.jsx)("th",{className:"table-header",children:"Submitted"}),(0,a.jsx)("th",{className:"table-header",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:p.map(e=>{var t,s,r,c,l,n;return(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"table-cell",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["ID: ",e.id]})]})}),(0,a.jsx)("td",{className:"table-cell",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-gray-900",children:e.email}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.phone})]})}),(0,a.jsx)("td",{className:"table-cell",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-gray-900",children:e.organization}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.department})]})}),(0,a.jsx)("td",{className:"table-cell",children:(0,a.jsx)("span",{className:"badge ".concat(getRoleBadge(e.requestedRole)),children:e.requestedRole.replace("_"," ").toUpperCase()})}),(0,a.jsx)("td",{className:"table-cell",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[getStatusIcon(e.status),(0,a.jsx)("span",{className:"badge ".concat(getStatusBadge(e.status)),children:e.status.toUpperCase()})]})}),(0,a.jsxs)("td",{className:"table-cell",children:[(0,a.jsx)("div",{className:"text-sm text-gray-900",children:(null===(r=e.createdAt)||void 0===r?void 0:null===(s=r.toDate)||void 0===s?void 0:null===(t=s.call(r))||void 0===t?void 0:t.toLocaleDateString())||"N/A"}),e.reviewedAt&&(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["Reviewed: ",null===(l=(n=e.reviewedAt).toDate)||void 0===l?void 0:null===(c=l.call(n))||void 0===c?void 0:c.toLocaleDateString()]})]}),(0,a.jsx)("td",{className:"table-cell",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("button",{className:"p-1 text-gray-400 hover:text-primary-600",children:(0,a.jsx)(o.Z,{className:"h-4 w-4"})}),"pending"===e.status&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>handleApproveRequest(e),className:"p-1 text-gray-400 hover:text-success-600",children:(0,a.jsx)(i.Z,{className:"h-4 w-4"})}),(0,a.jsx)("button",{onClick:()=>handleRejectRequest(e.id),className:"p-1 text-gray-400 hover:text-danger-600",children:(0,a.jsx)(d,{className:"h-4 w-4"})})]})]})})]},e.id)})})]})}),0===p.length&&(0,a.jsx)("div",{className:"text-center py-12",children:(0,a.jsx)("div",{className:"text-gray-500",children:"No access requests found"})})]})]})}}},function(e){e.O(0,[16,868,774,888,179],function(){return e(e.s=7401)}),_N_E=e.O()}]);