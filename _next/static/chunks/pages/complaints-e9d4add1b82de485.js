(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[67],{4464:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});var a=s(4297);let i=(0,a.Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},6895:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});var a=s(4297);let i=(0,a.Z)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]])},3718:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});var a=s(4297);let i=(0,a.Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},1150:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/complaints",function(){return s(5071)}])},5140:function(e,t,s){"use strict";s.d(t,{D:function(){return DataService}});var a=s(9828),i=s(7889);let DataService=class DataService{static async getDashboardStats(){try{let[e,t,s,r,l,o,n,c]=await Promise.all([(0,a.PL)((0,a.hJ)(i.db,"approvedUsers")),(0,a.PL)((0,a.IO)((0,a.hJ)(i.db,"approvedUsers"),(0,a.ar)("isActive","==",!0))),(0,a.PL)((0,a.IO)((0,a.hJ)(i.db,"accessRequests"),(0,a.ar)("status","==","pending"))),(0,a.PL)((0,a.hJ)(i.db,"complianceReports")),(0,a.PL)((0,a.hJ)(i.db,"inspections")),(0,a.PL)((0,a.hJ)(i.db,"feederPoints")),(0,a.PL)((0,a.hJ)(i.db,"teams")),(0,a.PL)((0,a.hJ)(i.db,"ipRecords"))]),d=e.docs.map(e=>({id:e.id,...e.data()})),m=t.docs.map(e=>({id:e.id,...e.data()})),u=d.filter(e=>"admin"===e.role).length,p=d.filter(e=>"task_force_team"===e.role).length,h=d.filter(e=>"commissioner"===e.role).length,f=d.filter(e=>!e.isActive).length,g=m.filter(e=>"admin"===e.role).length,b=m.filter(e=>"task_force_team"===e.role).length,y=m.filter(e=>"commissioner"===e.role).length;return{totalUsers:e.size,activeUsers:t.size,pendingRequests:s.size,totalComplaints:r.size,totalInspections:l.size,totalFeederPoints:o.size,totalTeams:n.size,totalIPRecords:c.size,adminUsers:u,taskForceUsers:p,commissionerUsers:h,inactiveUsers:f,activeAdmins:g,activeTaskForce:b,activeCommissioners:y}}catch(e){return console.error("Error fetching dashboard stats:",e),{totalUsers:0,activeUsers:0,pendingRequests:0,totalComplaints:0,totalInspections:0,totalFeederPoints:0,totalTeams:0,totalIPRecords:0,adminUsers:0,taskForceUsers:0,commissionerUsers:0,inactiveUsers:0,activeAdmins:0,activeTaskForce:0,activeCommissioners:0}}}static onUsersChange(e){let t=(0,a.IO)((0,a.hJ)(i.db,"approvedUsers"),(0,a.Xo)("createdAt","desc"));return(0,a.cf)(t,t=>{let s=t.docs.map(e=>({id:e.id,...e.data()}));e(s)})}static async getAllUsers(){let e=(0,a.IO)((0,a.hJ)(i.db,"approvedUsers")),t=await (0,a.PL)(e),s=t.docs.map(e=>({id:e.id,...e.data()}));return s}static onAccessRequestsChange(e){let t=(0,a.IO)((0,a.hJ)(i.db,"accessRequests"),(0,a.Xo)("createdAt","desc"));return(0,a.cf)(t,t=>{let s=t.docs.map(e=>({id:e.id,...e.data()}));e(s)})}static onComplaintsChange(e){let t=(0,a.IO)((0,a.hJ)(i.db,"complaints"),(0,a.Xo)("createdAt","desc"));return(0,a.cf)(t,t=>{let s=t.docs.map(e=>({id:e.id,...e.data()}));e(s)})}static async getAllComplaints(){let e=(0,a.IO)((0,a.hJ)(i.db,"complaints")),t=await (0,a.PL)(e),s=t.docs.map(e=>({id:e.id,...e.data()}));return s}static async getAllComplianceReports(){let e=(0,a.IO)((0,a.hJ)(i.db,"complianceReports"),(0,a.Xo)("submittedAt","desc")),t=await (0,a.PL)(e),s=t.docs.map(e=>({id:e.id,...e.data()}));return s}static onComplianceReportsChange(e){let t=(0,a.IO)((0,a.hJ)(i.db,"complianceReports"),(0,a.Xo)("submittedAt","desc"));return(0,a.cf)(t,t=>{let s=t.docs.map(e=>({id:e.id,...e.data()}));e(s)})}static async updateComplianceReportStatus(e,t,s,r){try{let l={status:t,reviewedAt:(0,a.Bt)(),updatedAt:(0,a.Bt)()};s&&(l.adminNotes=s),r&&(l.reviewedBy=r),await (0,a.r7)((0,a.JU)(i.db,"complianceReports",e),l),console.log("✅ Compliance report status updated:",e,t)}catch(e){throw console.error("❌ Error updating compliance report status:",e),e}}static onIPRecordsChange(e){let t=(0,a.IO)((0,a.hJ)(i.db,"ipRecords"),(0,a.Xo)("registeredAt","desc"));return(0,a.cf)(t,t=>{let s=t.docs.map(e=>({id:e.id,...e.data()}));e(s)})}static onFeederPointsChange(e){let t=(0,a.IO)((0,a.hJ)(i.db,"feederPoints"));return(0,a.cf)(t,t=>{let s=t.docs.map(e=>({id:e.id,...e.data()}));e(s)})}static async getAllFeederPoints(){let e=(0,a.IO)((0,a.hJ)(i.db,"feederPoints")),t=await (0,a.PL)(e),s=t.docs.map(e=>({id:e.id,...e.data()}));return s}static onTeamsChange(e){let t=(0,a.IO)((0,a.hJ)(i.db,"teams"));return(0,a.cf)(t,t=>{let s=t.docs.map(e=>({id:e.id,...e.data()}));e(s)})}static async updateFeederPoint(e,t){let s=(0,a.JU)(i.db,"feederPoints",e);await (0,a.r7)(s,t)}static async createFeederPoint(e){let t=(0,a.hJ)(i.db,"feederPoints");await (0,a.pl)((0,a.JU)(t),e,{merge:!0})}static async deleteFeederPoint(e){let t=(0,a.JU)(i.db,"feederPoints",e);await (0,a.oe)(t)}static async createSampleFeederPoints(){let e=(0,a.hJ)(i.db,"feederPoints");for(let t of[{name:"FP-001",status:"active",priority:"high",location:{address:"123 Main St",latitude:34.0522,longitude:-118.2437}},{name:"FP-002",status:"maintenance",priority:"medium",location:{address:"456 Oak Ave",latitude:34.0522,longitude:-118.2437}},{name:"FP-003",status:"inactive",priority:"low",location:{address:"789 Pine Ln",latitude:34.0522,longitude:-118.2437}}])await (0,a.pl)((0,a.JU)(e),t)}static async getRecentActivity(){try{let e=(0,a.IO)((0,a.hJ)(i.db,"recentActivity"),(0,a.Xo)("timestamp","desc"),(0,a.b9)(10)),t=await (0,a.PL)(e),s=t.docs.map(e=>({id:e.id,...e.data()}));return s}catch(e){return console.error("Error fetching recent activity:",e),[]}}static async approveAccessRequest(e){try{let t=(0,a.JU)(i.db,"accessRequests",e.id);await (0,a.r7)(t,{status:"approved",reviewedAt:(0,a.Bt)(),reviewedBy:"AdminUserPlaceholder",updatedAt:(0,a.Bt)()}),console.log("✅ Access request approved:",e.id)}catch(e){throw console.error("❌ Error approving access request:",e),e}}static async rejectAccessRequest(e){try{let t=(0,a.JU)(i.db,"accessRequests",e);await (0,a.r7)(t,{status:"rejected",reviewedAt:(0,a.Bt)(),reviewedBy:"AdminUserPlaceholder",updatedAt:(0,a.Bt)()}),console.log("✅ Access request rejected:",e)}catch(e){throw console.error("❌ Error rejecting access request:",e),e}}static async updateComplaint(e,t){try{let s=(0,a.JU)(i.db,"complaints",e);await (0,a.r7)(s,{...t,updatedAt:(0,a.Bt)()}),console.log("✅ Complaint updated:",e)}catch(e){throw console.error("❌ Error updating complaint:",e),e}}static async deleteComplaint(e){try{await (0,a.oe)((0,a.JU)(i.db,"complaints",e)),console.log("✅ Complaint deleted:",e)}catch(e){throw console.error("❌ Error deleting complaint:",e),e}}static async testDatabaseConnection(){try{console.log("Attempting to fetch collections from Firestore...");let e=await Promise.all([(0,a.PL)((0,a.hJ)(i.db,"approvedUsers")),(0,a.PL)((0,a.hJ)(i.db,"accessRequests")),(0,a.PL)((0,a.hJ)(i.db,"complianceReports")),(0,a.PL)((0,a.hJ)(i.db,"feederPoints")),(0,a.PL)((0,a.hJ)(i.db,"teams"))]);return console.log("Successfully fetched collections:"),console.log("- approvedUsers: ".concat(e[0].size," documents")),console.log("- accessRequests: ".concat(e[1].size," documents")),console.log("- complianceReports: ".concat(e[2].size," documents")),console.log("- feederPoints: ".concat(e[3].size," documents")),console.log("- teams: ".concat(e[4].size," documents")),!0}catch(e){return console.error("Error testing database connection:",e),!1}}static async getUserReports(e){let t=(0,a.IO)((0,a.hJ)(i.db,"complianceReports"),(0,a.ar)("userId","==",e)),s=await (0,a.PL)(t);return s.docs.map(e=>({id:e.id,...e.data()}))}static async getUserFeederPoints(e){let t=(0,a.IO)((0,a.hJ)(i.db,"feederPoints"),(0,a.ar)("assignedUserId","==",e)),s=await (0,a.PL)(t);return s.docs.map(e=>({id:e.id,...e.data()}))}static async updateUser(e,t){let s=(0,a.JU)(i.db,"approvedUsers",e);await (0,a.r7)(s,t)}static async deleteUser(e){let t=(0,a.JU)(i.db,"approvedUsers",e);await (0,a.oe)(t)}}},7889:function(e,t,s){"use strict";s.d(t,{db:function(){return l}});var a=s(3977),i=s(9828);let r=(0,a.ZF)({apiKey:"AIzaSyAUl-1iNJo7MjMgKk_vBaBKeDNEYVSxSDE",authDomain:"task-force-b1ff7.firebaseapp.com",projectId:"task-force-b1ff7",storageBucket:"task-force-b1ff7.firebasestorage.app",messagingSenderId:"1029709761200",appId:"1:1029709761200:web:d051815003907ec7f14975"}),l=(0,i.ad)(r)},5071:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return ComplaintsPage}});var a=s(5893),i=s(7294),r=s(4464),l=s(6895),o=s(3718),n=s(5140);function ComplaintsPage(){let[e,t]=(0,i.useState)([]),[s,c]=(0,i.useState)([]),[d,m]=(0,i.useState)(!0),[u,p]=(0,i.useState)(""),[h,f]=(0,i.useState)("all"),[g,b]=(0,i.useState)("all"),[y,x]=(0,i.useState)(null),[v,w]=(0,i.useState)(!1),[C,j]=(0,i.useState)(null),[P,N]=(0,i.useState)(!1),loadComplaints=()=>{m(!0);let e=n.D.onComplaintsChange(e=>{t(e),m(!1)});return e};(0,i.useEffect)(()=>{let e=loadComplaints();return()=>e()},[]),(0,i.useEffect)(()=>{filterComplaints()},[e,u,h,g]);let filterComplaints=()=>{let t=e;u&&(t=t.filter(e=>e.title.toLowerCase().includes(u.toLowerCase())||e.description.toLowerCase().includes(u.toLowerCase()))),"all"!==h&&(t=t.filter(e=>e.status===h)),"all"!==g&&(t=t.filter(e=>e.priority===g)),c(t)},handleViewComplaint=e=>{x(e),w(!0)},handleEditComplaint=e=>{j({...e}),N(!0)},handleSaveComplaint=async()=>{if(C)try{await n.D.updateComplaint(C.id,C),await loadComplaints(),N(!1),j(null),alert("Complaint updated successfully!")}catch(e){console.error("Error updating complaint:",e),alert("Error updating complaint. Please try again.")}},handleDeleteComplaint=async e=>{if(confirm('Are you sure you want to delete complaint "'.concat(e.title,'"?')))try{await n.D.deleteComplaint(e.id),await loadComplaints(),alert("Complaint deleted successfully!")}catch(e){console.error("Error deleting complaint:",e),alert("Error deleting complaint. Please try again.")}};return d?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Complaints"}),(0,a.jsx)("div",{className:"table-container",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"table-header",children:"Title"}),(0,a.jsx)("th",{className:"table-header",children:"Category"}),(0,a.jsx)("th",{className:"table-header",children:"Priority"}),(0,a.jsx)("th",{className:"table-header",children:"Status"}),(0,a.jsx)("th",{className:"table-header",children:"Reported By"}),(0,a.jsx)("th",{className:"table-header",children:"Created At"}),(0,a.jsx)("th",{className:"table-header",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(e=>{var t,s;return(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"table-cell",children:e.title}),(0,a.jsx)("td",{className:"table-cell",children:e.category}),(0,a.jsx)("td",{className:"table-cell",children:e.priority}),(0,a.jsx)("td",{className:"table-cell",children:e.status}),(0,a.jsx)("td",{className:"table-cell",children:e.reportedBy}),(0,a.jsx)("td",{className:"table-cell",children:null===(s=e.createdAt)||void 0===s?void 0:null===(t=s.toDate)||void 0===t?void 0:t.call(s).toLocaleDateString()}),(0,a.jsx)("td",{className:"table-cell",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("button",{onClick:()=>handleViewComplaint(e),children:(0,a.jsx)(r.Z,{className:"h-4 w-4"})}),(0,a.jsx)("button",{onClick:()=>handleEditComplaint(e),children:(0,a.jsx)(l.Z,{className:"h-4 w-4"})}),(0,a.jsx)("button",{onClick:()=>handleDeleteComplaint(e),children:(0,a.jsx)(o.Z,{className:"h-4 w-4"})})]})})]},e.id)})})]})}),P&&C&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,a.jsxs)("div",{className:"flex items-center justify-center min-h-screen",children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75",onClick:()=>N(!1)}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-xl transform transition-all sm:max-w-lg sm:w-full",children:(0,a.jsxs)("div",{className:"px-4 py-5 sm:p-6",children:[(0,a.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Edit Complaint"}),(0,a.jsx)("div",{className:"mt-2 max-w-xl text-sm text-gray-500",children:(0,a.jsx)("p",{children:"Update the details of the complaint."})}),(0,a.jsxs)("form",{className:"mt-5 sm:flex sm:items-center",children:[(0,a.jsxs)("div",{className:"w-full sm:max-w-xs",children:[(0,a.jsx)("label",{htmlFor:"status",className:"sr-only",children:"Status"}),(0,a.jsxs)("select",{id:"status",name:"status",value:C.status,onChange:e=>j({...C,status:e.target.value}),className:"block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",children:[(0,a.jsx)("option",{value:"open",children:"Open"}),(0,a.jsx)("option",{value:"in_progress",children:"In Progress"}),(0,a.jsx)("option",{value:"resolved",children:"Resolved"}),(0,a.jsx)("option",{value:"closed",children:"Closed"})]})]}),(0,a.jsx)("button",{type:"button",onClick:handleSaveComplaint,className:"mt-3 w-full inline-flex items-center justify-center px-4 py-2 border border-transparent shadow-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",children:"Save"}),(0,a.jsx)("button",{type:"button",onClick:()=>N(!1),className:"mt-3 w-full inline-flex items-center justify-center px-4 py-2 border border-gray-300 shadow-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",children:"Cancel"})]})]})})]})})]})}}},function(e){e.O(0,[16,868,774,888,179],function(){return e(e.s=1150)}),_N_E=e.O()}]);