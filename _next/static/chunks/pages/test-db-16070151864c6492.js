(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[777],{2946:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/test-db",function(){return s(649)}])},5140:function(e,t,s){"use strict";s.d(t,{D:function(){return DataService}});var a=s(9828),o=s(7889);let DataService=class DataService{static async getDashboardStats(){try{let[e,t,s,c,r,n,i,d]=await Promise.all([(0,a.PL)((0,a.hJ)(o.db,"approvedUsers")),(0,a.PL)((0,a.IO)((0,a.hJ)(o.db,"approvedUsers"),(0,a.ar)("isActive","==",!0))),(0,a.PL)((0,a.IO)((0,a.hJ)(o.db,"accessRequests"),(0,a.ar)("status","==","pending"))),(0,a.PL)((0,a.hJ)(o.db,"complianceReports")),(0,a.PL)((0,a.hJ)(o.db,"inspections")),(0,a.PL)((0,a.hJ)(o.db,"feederPoints")),(0,a.PL)((0,a.hJ)(o.db,"teams")),(0,a.PL)((0,a.hJ)(o.db,"ipRecords"))]);return{totalUsers:e.size,activeUsers:t.size,pendingRequests:s.size,totalComplaints:c.size,totalInspections:r.size,totalFeederPoints:n.size,totalTeams:i.size,totalIPRecords:d.size}}catch(e){return console.error("Error fetching dashboard stats:",e),{totalUsers:0,activeUsers:0,pendingRequests:0,totalComplaints:0,totalInspections:0,totalFeederPoints:0,totalTeams:0,totalIPRecords:0}}}static onUsersChange(e){let t=(0,a.IO)((0,a.hJ)(o.db,"approvedUsers"),(0,a.Xo)("createdAt","desc"));return(0,a.cf)(t,t=>{let s=t.docs.map(e=>({id:e.id,...e.data()}));e(s)})}static async getAllUsers(){let e=(0,a.IO)((0,a.hJ)(o.db,"approvedUsers")),t=await (0,a.PL)(e),s=t.docs.map(e=>({id:e.id,...e.data()}));return s}static onAccessRequestsChange(e){let t=(0,a.IO)((0,a.hJ)(o.db,"accessRequests"),(0,a.Xo)("createdAt","desc"));return(0,a.cf)(t,t=>{let s=t.docs.map(e=>({id:e.id,...e.data()}));e(s)})}static onComplaintsChange(e){let t=(0,a.IO)((0,a.hJ)(o.db,"complaints"),(0,a.Xo)("createdAt","desc"));return(0,a.cf)(t,t=>{let s=t.docs.map(e=>({id:e.id,...e.data()}));e(s)})}static async getAllComplaints(){let e=(0,a.IO)((0,a.hJ)(o.db,"complaints")),t=await (0,a.PL)(e),s=t.docs.map(e=>({id:e.id,...e.data()}));return s}static async getAllComplianceReports(){let e=(0,a.IO)((0,a.hJ)(o.db,"complianceReports"),(0,a.Xo)("submittedAt","desc")),t=await (0,a.PL)(e),s=t.docs.map(e=>({id:e.id,...e.data()}));return s}static onComplianceReportsChange(e){let t=(0,a.IO)((0,a.hJ)(o.db,"complianceReports"),(0,a.Xo)("submittedAt","desc"));return(0,a.cf)(t,t=>{let s=t.docs.map(e=>({id:e.id,...e.data()}));e(s)})}static async updateComplianceReportStatus(e,t,s,c){try{let r={status:t,reviewedAt:(0,a.Bt)(),updatedAt:(0,a.Bt)()};s&&(r.adminNotes=s),c&&(r.reviewedBy=c),await (0,a.r7)((0,a.JU)(o.db,"complianceReports",e),r),console.log("✅ Compliance report status updated:",e,t)}catch(e){throw console.error("❌ Error updating compliance report status:",e),e}}static onIPRecordsChange(e){let t=(0,a.IO)((0,a.hJ)(o.db,"ipRecords"),(0,a.Xo)("registeredAt","desc"));return(0,a.cf)(t,t=>{let s=t.docs.map(e=>({id:e.id,...e.data()}));e(s)})}static onFeederPointsChange(e){let t=(0,a.IO)((0,a.hJ)(o.db,"feederPoints"));return(0,a.cf)(t,t=>{let s=t.docs.map(e=>({id:e.id,...e.data()}));e(s)})}static async getAllFeederPoints(){let e=(0,a.IO)((0,a.hJ)(o.db,"feederPoints")),t=await (0,a.PL)(e),s=t.docs.map(e=>({id:e.id,...e.data()}));return s}static onTeamsChange(e){let t=(0,a.IO)((0,a.hJ)(o.db,"teams"));return(0,a.cf)(t,t=>{let s=t.docs.map(e=>({id:e.id,...e.data()}));e(s)})}static async updateFeederPoint(e,t){let s=(0,a.JU)(o.db,"feederPoints",e);await (0,a.r7)(s,t)}static async createFeederPoint(e){let t=(0,a.hJ)(o.db,"feederPoints");await (0,a.pl)((0,a.JU)(t),e,{merge:!0})}static async deleteFeederPoint(e){let t=(0,a.JU)(o.db,"feederPoints",e);await (0,a.oe)(t)}static async createSampleFeederPoints(){let e=(0,a.hJ)(o.db,"feederPoints");for(let t of[{name:"FP-001",status:"active",priority:"high",location:{address:"123 Main St",latitude:34.0522,longitude:-118.2437}},{name:"FP-002",status:"maintenance",priority:"medium",location:{address:"456 Oak Ave",latitude:34.0522,longitude:-118.2437}},{name:"FP-003",status:"inactive",priority:"low",location:{address:"789 Pine Ln",latitude:34.0522,longitude:-118.2437}}])await (0,a.pl)((0,a.JU)(e),t)}static async getRecentActivity(){try{let e=(0,a.IO)((0,a.hJ)(o.db,"recentActivity"),(0,a.Xo)("timestamp","desc"),(0,a.b9)(10)),t=await (0,a.PL)(e),s=t.docs.map(e=>({id:e.id,...e.data()}));return s}catch(e){return console.error("Error fetching recent activity:",e),[]}}static async approveAccessRequest(e){try{let t=(0,a.JU)(o.db,"accessRequests",e.id);await (0,a.r7)(t,{status:"approved",reviewedAt:(0,a.Bt)(),reviewedBy:"AdminUserPlaceholder",updatedAt:(0,a.Bt)()}),console.log("✅ Access request approved:",e.id)}catch(e){throw console.error("❌ Error approving access request:",e),e}}static async rejectAccessRequest(e){try{let t=(0,a.JU)(o.db,"accessRequests",e);await (0,a.r7)(t,{status:"rejected",reviewedAt:(0,a.Bt)(),reviewedBy:"AdminUserPlaceholder",updatedAt:(0,a.Bt)()}),console.log("✅ Access request rejected:",e)}catch(e){throw console.error("❌ Error rejecting access request:",e),e}}static async updateComplaint(e,t){try{let s=(0,a.JU)(o.db,"complaints",e);await (0,a.r7)(s,{...t,updatedAt:(0,a.Bt)()}),console.log("✅ Complaint updated:",e)}catch(e){throw console.error("❌ Error updating complaint:",e),e}}static async deleteComplaint(e){try{await (0,a.oe)((0,a.JU)(o.db,"complaints",e)),console.log("✅ Complaint deleted:",e)}catch(e){throw console.error("❌ Error deleting complaint:",e),e}}static async testDatabaseConnection(){try{console.log("Attempting to fetch collections from Firestore...");let e=await Promise.all([(0,a.PL)((0,a.hJ)(o.db,"approvedUsers")),(0,a.PL)((0,a.hJ)(o.db,"accessRequests")),(0,a.PL)((0,a.hJ)(o.db,"complianceReports")),(0,a.PL)((0,a.hJ)(o.db,"feederPoints")),(0,a.PL)((0,a.hJ)(o.db,"teams"))]);return console.log("Successfully fetched collections:"),console.log("- approvedUsers: ".concat(e[0].size," documents")),console.log("- accessRequests: ".concat(e[1].size," documents")),console.log("- complianceReports: ".concat(e[2].size," documents")),console.log("- feederPoints: ".concat(e[3].size," documents")),console.log("- teams: ".concat(e[4].size," documents")),!0}catch(e){return console.error("Error testing database connection:",e),!1}}static async getUserReports(e){let t=(0,a.IO)((0,a.hJ)(o.db,"complianceReports"),(0,a.ar)("userId","==",e)),s=await (0,a.PL)(t);return s.docs.map(e=>({id:e.id,...e.data()}))}static async getUserFeederPoints(e){let t=(0,a.IO)((0,a.hJ)(o.db,"feederPoints"),(0,a.ar)("assignedUserId","==",e)),s=await (0,a.PL)(t);return s.docs.map(e=>({id:e.id,...e.data()}))}static async updateUser(e,t){let s=(0,a.JU)(o.db,"approvedUsers",e);await (0,a.r7)(s,t)}static async deleteUser(e){let t=(0,a.JU)(o.db,"approvedUsers",e);await (0,a.oe)(t)}}},7889:function(e,t,s){"use strict";s.d(t,{db:function(){return i}});var a=s(3977),o=s(9828),c=s(3454);let r={apiKey:c.env.EXPO_PUBLIC_FIREBASE_API_KEY||"AIzaSyAUl-1iNJo7MjMgKk_vBaBKeDNEYVSxSDE",authDomain:c.env.EXPO_PUBLIC_FIREBASE_AUTH_DOMAIN||"task-force-b1ff7.firebaseapp.com",projectId:c.env.EXPO_PUBLIC_FIREBASE_PROJECT_ID||"task-force-b1ff7",storageBucket:c.env.EXPO_PUBLIC_FIREBASE_STORAGE_BUCKET||"task-force-b1ff7.firebasestorage.app",messagingSenderId:c.env.EXPO_PUBLIC_FIREBASE_MESSAGING_SENDER_ID||"1029709761200",appId:c.env.EXPO_PUBLIC_FIREBASE_APP_ID||"1:1029709761200:web:d051815003907ec7f14975"},n=(0,a.ZF)(r),i=(0,o.ad)(n)},649:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return TestDbPage}});var a=s(5893),o=s(7294),c=s(5140);function TestDbPage(){let[e,t]=(0,o.useState)(!1),[s,r]=(0,o.useState)(null),handleTestClick=async()=>{t(!0),r(null),console.log("Starting database connection test...");let e=await c.D.testDatabaseConnection();e?(console.log("Test function returned success."),r("Connection test completed successfully! Check the console for details on collection counts.")):(console.log("Test function returned failure."),r("Connection test failed. Check the browser's developer console for specific error messages from Firebase.")),t(!1)};return(0,a.jsxs)("div",{style:{padding:"40px",fontFamily:"sans-serif"},children:[(0,a.jsx)("h1",{children:"Firebase Connection Test"}),(0,a.jsx)("p",{children:"Click the button below to test the connection to your Firestore database."}),(0,a.jsx)("p",{children:"Open your browser\\'s developer console (usually by pressing F12) to see detailed logs."}),(0,a.jsx)("button",{onClick:handleTestClick,disabled:e,style:{padding:"10px 20px",fontSize:"16px",cursor:"pointer"},children:e?"Testing...":"Run Connection Test"}),s&&(0,a.jsxs)("div",{style:{marginTop:"20px",padding:"10px",border:"1px solid #ccc",borderRadius:"5px"},children:[(0,a.jsx)("h2",{children:"Result:"}),(0,a.jsx)("p",{children:s})]})]})}}},function(e){e.O(0,[16,868,774,888,179],function(){return e(e.s=2946)}),_N_E=e.O()}]);